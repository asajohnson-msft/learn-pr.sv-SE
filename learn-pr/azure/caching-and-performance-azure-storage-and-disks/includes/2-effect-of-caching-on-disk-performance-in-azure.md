<span data-ttu-id="60d80-101">Vi ska titta på de faktorer som påverkar diskprestanda i Azure och hur cachelagring kan hjälpa dig att optimera prestanda.</span><span class="sxs-lookup"><span data-stu-id="60d80-101">We're going to look at the factors that affect disk performance in Azure, and how caching can help optimize performance.</span></span> 

### <a name="disk-caching"></a><span data-ttu-id="60d80-102">Diskcachelagring</span><span class="sxs-lookup"><span data-stu-id="60d80-102">Disk caching</span></span>

<span data-ttu-id="60d80-103">En cache är en särskild komponent i en dator som lagrar data så att de kan nås snabbare, vanligtvis i minnet.</span><span class="sxs-lookup"><span data-stu-id="60d80-103">A cache is a specialized component in a computer that stores data so it can be accessed faster, typically in memory.</span></span> <span data-ttu-id="60d80-104">Data i ett cacheminne är ofta data som tidigare har lästs eller data som kommer från en tidigare beräkning.</span><span class="sxs-lookup"><span data-stu-id="60d80-104">The data in a cache is often data that has been read previously, or is data that resulted from an earlier calculation.</span></span> <span data-ttu-id="60d80-105">Målet är att komma åt data snabbare än om de läses från disken.</span><span class="sxs-lookup"><span data-stu-id="60d80-105">The goal is to access data faster than getting it from disk.</span></span>

<span data-ttu-id="60d80-106">Cachelagring använder specialiserad och ibland dyr tillfällig lagring som har snabbare prestanda för läsning och/eller skrivning än vad permanent lagring har.</span><span class="sxs-lookup"><span data-stu-id="60d80-106">Caching uses specialized, and sometimes expensive, temporary storage that has faster read and/or write performance than permanent storage.</span></span> <span data-ttu-id="60d80-107">Eftersom den här cachelagringen ofta är begränsad behöver man bestämma vilka dataåtgärder som gagnas mest av cachelagring.</span><span class="sxs-lookup"><span data-stu-id="60d80-107">Because this cache storage is often limited, decisions need to be made as to what data operations will benefit most from caching.</span></span> <span data-ttu-id="60d80-108">Men även där cacheminne kan göras mycket tillgängligt, till exempel i Azure, är det fortfarande viktigt att känna till arbetsbelastningmönstren för varje disk innan du bestämmer vilken typ av cachelagring som ska användas.</span><span class="sxs-lookup"><span data-stu-id="60d80-108">But even where the cache can be made widely available, such as in Azure, it's still important to know the workload patterns of each disk before deciding on what caching type to use.</span></span>

<span data-ttu-id="60d80-109">**Cachelagring för läsning** försöker göra datahämtning snabbare.</span><span class="sxs-lookup"><span data-stu-id="60d80-109">**Read caching** tries to speed up data retrieval.</span></span> <span data-ttu-id="60d80-110">I stället för att läsa från permanent lagring läses data från det snabbare cacheminnet.</span><span class="sxs-lookup"><span data-stu-id="60d80-110">Instead of reading from permanent storage, the data is read from the faster cache.</span></span> <span data-ttu-id="60d80-111">Dataläsning träffar cacheminnet under följande omständigheter.</span><span class="sxs-lookup"><span data-stu-id="60d80-111">Data reads hit the cache under the following conditions.</span></span>

- <span data-ttu-id="60d80-112">Data har lästs in förut och finns i cacheminnet.</span><span class="sxs-lookup"><span data-stu-id="60d80-112">The data has been read before and exists in the cache.</span></span>
- <span data-ttu-id="60d80-113">Cacheminnet är tillräckligt stort för att rymma alla dessa data.</span><span class="sxs-lookup"><span data-stu-id="60d80-113">And the cache is large enough to hold all of this data.</span></span>

<span data-ttu-id="60d80-114">Observera att cachelagring för läsning fungerar när det finns viss _förutsägbarhet_ i läsningskön, till exempel en uppsättning sekventiella läsåtgärder.</span><span class="sxs-lookup"><span data-stu-id="60d80-114">It's important to note that read caching helps when there is some _predictability_ to the read queue, such as a set of sequential reads.</span></span> <span data-ttu-id="60d80-115">För slumpmässig I/O, där de data som du läser är spridda över lagringen, finns det få eller inga fördelar med cachelagring, och det kan till och med minska diskprestanda.</span><span class="sxs-lookup"><span data-stu-id="60d80-115">For random IO, where the data you're accessing is scattered across storage, caching will be of little or no benefit, and can even reduce disk performance.</span></span>

<span data-ttu-id="60d80-116">**Cachelagring för skrivning** försöker göra dataskrivning till lagring snabbare.</span><span class="sxs-lookup"><span data-stu-id="60d80-116">**Write caching** tries to speed up writing data to storage.</span></span> <span data-ttu-id="60d80-117">Genom att använda en cachelagring för skrivning kan appen överväga de data som ska sparas.</span><span class="sxs-lookup"><span data-stu-id="60d80-117">By using a write cache, the app can consider the data to be saved.</span></span> <span data-ttu-id="60d80-118">I verkligheten placeras data i kö i ett cacheminne som väntar på att skrivas till permanent lagring.</span><span class="sxs-lookup"><span data-stu-id="60d80-118">In reality, the data is queued up in a cache waiting to be written to permanent storage.</span></span> <span data-ttu-id="60d80-119">Den här mekanismen är en potentiell källa till fel om systemet stängs ned innan dessa cachelagrade data överförs till disk.</span><span class="sxs-lookup"><span data-stu-id="60d80-119">As you can imagine, this mechanism can be a potential point of failure, if the system shuts down before this cached data is flushed to disk.</span></span> <span data-ttu-id="60d80-120">Vissa system, till exempel SQL Server, hanterar själva skrivning av cachelagrade data till beständig disklagring.</span><span class="sxs-lookup"><span data-stu-id="60d80-120">Some systems, such as SQL Server, handle writing cached data to persistent disk storage themselves.</span></span>  

### <a name="azure-disk-caching"></a><span data-ttu-id="60d80-121">Azure-diskcachelagring</span><span class="sxs-lookup"><span data-stu-id="60d80-121">Azure disk caching</span></span>

<span data-ttu-id="60d80-122">Det finns två typer av diskcachelagring som berör disklagring:</span><span class="sxs-lookup"><span data-stu-id="60d80-122">There are two types of disk caching that concern disk storage:</span></span>

- <span data-ttu-id="60d80-123">Azure-cachelagring</span><span class="sxs-lookup"><span data-stu-id="60d80-123">Azure storage caching</span></span>
- <span data-ttu-id="60d80-124">Diskcachelagring för virtuella Azure-datorer</span><span class="sxs-lookup"><span data-stu-id="60d80-124">Azure virtual machine disk caching</span></span>

<span data-ttu-id="60d80-125">Azure-cachelagring tillhandahåller cachelagringstjänster för Azure Blob-lagring, Azure Files och annat innehåll i Azure.</span><span class="sxs-lookup"><span data-stu-id="60d80-125">Azure storage caching provides cache services for Azure Blob storage, Azure Files, and other content in Azure.</span></span> <span data-ttu-id="60d80-126">Konfiguration av dessa cachetyper ligger inte inom ramen för den här modulen.</span><span class="sxs-lookup"><span data-stu-id="60d80-126">Configuration of these types of cache is beyond the scope of this module.</span></span>

<span data-ttu-id="60d80-127">Diskcachelagring för virtuella Azure-datorer handlar om att optimera läs- och skrivåtkomst till de virtuell hårddiskfiler (VHD) som ansluts till virtuella Azure-datorer.</span><span class="sxs-lookup"><span data-stu-id="60d80-127">Azure virtual machine disk caching is about optimizing read and write access to the virtual hard disk (VHD) files attached to Azure VMs.</span></span> <span data-ttu-id="60d80-128">Vi fokuserar på diskcachelagring i den här modulen.</span><span class="sxs-lookup"><span data-stu-id="60d80-128">We'll focus on disk caching in this module.</span></span>

### <a name="azure-virtual-machine-disk-types"></a><span data-ttu-id="60d80-129">Disklagringstyper för virtuella Azure-datorer</span><span class="sxs-lookup"><span data-stu-id="60d80-129">Azure virtual machine disk types</span></span>

<span data-ttu-id="60d80-130">Det finns tre typer av diskar som används med virtuella Azure-datorer (VM).</span><span class="sxs-lookup"><span data-stu-id="60d80-130">There are three types of disks used with Azure virtual machines (VM).</span></span>

- <span data-ttu-id="60d80-131">**OS-disk**: när du skapar en virtuell Azure-dator ansluter Azure automatiskt en virtuell hårddisk för operativsystemet (OS).</span><span class="sxs-lookup"><span data-stu-id="60d80-131">**OS disk**: When you create an Azure VM, Azure automatically attaches a VHD for the operating system (OS).</span></span> <span data-ttu-id="60d80-132">Den virtuella hårddisken lagras som en sidblob i Azure-lagringen.</span><span class="sxs-lookup"><span data-stu-id="60d80-132">The VHD is stored as a page blob in Azure storage.</span></span>
- <span data-ttu-id="60d80-133">**Tillfällig disk**: när du skapar en virtuell Azure-dator lägger Azure även automatiskt till en tillfällig disk.</span><span class="sxs-lookup"><span data-stu-id="60d80-133">**Temporary disk**: When you create an Azure VM, Azure also automatically adds a temporary disk.</span></span> <span data-ttu-id="60d80-134">Den här disken används för data, till exempel sido- och växlingsfiler.</span><span class="sxs-lookup"><span data-stu-id="60d80-134">This disk is used for data such as page and swap files.</span></span> <span data-ttu-id="60d80-135">Data på den här disken kan gå förlorade under underhåll eller vid omdistribuering av en virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="60d80-135">The data on this disk may be lost during maintenance or a VM redeploy.</span></span> <span data-ttu-id="60d80-136">Därför bör du inte använda den för att lagra permanenta data såsom databasfiler eller transaktionsloggar.</span><span class="sxs-lookup"><span data-stu-id="60d80-136">So, don't use it for storing permanent data, such as database files or transaction logs.</span></span>
- <span data-ttu-id="60d80-137">**Datadiskar**: en datadisk är en virtuell hårddisk som är ansluten till en virtuell dator för att lagra programdata eller andra data som du behöver bevara.</span><span class="sxs-lookup"><span data-stu-id="60d80-137">**Data disks**: A data disk is a VHD that's attached to a virtual machine to store application data, or other data you need to keep.</span></span>

<span data-ttu-id="60d80-138">OS-diskar och datadiskar drar nytta av diskcachelagring för virtuella Azure-datorer.</span><span class="sxs-lookup"><span data-stu-id="60d80-138">OS disks and data disks take advantage of Azure VM disk caching.</span></span> <span data-ttu-id="60d80-139">Cachestorleken för en virtuell datordisk beror på VM-instansens storlek och antalet diskar som monterats på den virtuella datorn.</span><span class="sxs-lookup"><span data-stu-id="60d80-139">The cache size for a VM disk depends on the VM instance size and on the number of disks mounted on the VM.</span></span> <span data-ttu-id="60d80-140">Cachelagring kan bara aktiveras för upp till fyra datadiskar.</span><span class="sxs-lookup"><span data-stu-id="60d80-140">Caching can only be enabled for up to four data disks.</span></span>

## <a name="cache-options-for-azure-vms"></a><span data-ttu-id="60d80-141">Cachelagringsalternativ för virtuella Azure-datorer</span><span class="sxs-lookup"><span data-stu-id="60d80-141">Cache options for Azure VMs</span></span>

<span data-ttu-id="60d80-142">Det finns tre vanliga alternativ för VM-diskcachelagring.</span><span class="sxs-lookup"><span data-stu-id="60d80-142">There are three common options for VM disk caching.</span></span>

- <span data-ttu-id="60d80-143">**Läsa/skriva** – återskrivningscache.</span><span class="sxs-lookup"><span data-stu-id="60d80-143">**Read/write** – write back cache.</span></span>  <span data-ttu-id="60d80-144">Använd bara det här alternativet om programmet hanterar skrivning av cachelagrade data till beständiga diskar när det behövs</span><span class="sxs-lookup"><span data-stu-id="60d80-144">Only use this option if your application properly handles writing cached data to persistent disks when needed</span></span>
- <span data-ttu-id="60d80-145">**Skrivskyddad** – läsningar utförs från cachen.</span><span class="sxs-lookup"><span data-stu-id="60d80-145">**Read-only** - reads are performed from cache.</span></span>
- <span data-ttu-id="60d80-146">**Ingen** – ingen cachelagring.</span><span class="sxs-lookup"><span data-stu-id="60d80-146">**None** - no cache.</span></span> <span data-ttu-id="60d80-147">Välj det här alternativet för lässkyddade och skrivintensiva diskar.</span><span class="sxs-lookup"><span data-stu-id="60d80-147">Select this option for write-only and write-heavy disks.</span></span> <span data-ttu-id="60d80-148">Loggfiler är ett bra alternativ eftersom de är skrivintensiva åtgärder.</span><span class="sxs-lookup"><span data-stu-id="60d80-148">Log files are a good candidate since they're write-heavy operations.</span></span>

<span data-ttu-id="60d80-149">Inte alla cachelagringsalternativet är tillgängliga för alla disktyper.</span><span class="sxs-lookup"><span data-stu-id="60d80-149">Not every caching option is available for each type of disk.</span></span> <span data-ttu-id="60d80-150">I följande tabell visas cachelagringsalternativen för varje disktyp:</span><span class="sxs-lookup"><span data-stu-id="60d80-150">The following table shows you the caching options for each disk type:</span></span>

| |<span data-ttu-id="60d80-151">**Skrivskyddad**</span><span class="sxs-lookup"><span data-stu-id="60d80-151">**Read-only**</span></span>  |<span data-ttu-id="60d80-152">**Läsa/skriva**</span><span class="sxs-lookup"><span data-stu-id="60d80-152">**Read/write**</span></span>  |<span data-ttu-id="60d80-153">**Ingen**</span><span class="sxs-lookup"><span data-stu-id="60d80-153">**None**</span></span>  |
|---------|---------|---------|---------|
|<span data-ttu-id="60d80-154">OS-disk</span><span class="sxs-lookup"><span data-stu-id="60d80-154">OS disk</span></span>     |   <span data-ttu-id="60d80-155">ja</span><span class="sxs-lookup"><span data-stu-id="60d80-155">yes</span></span>      |   <span data-ttu-id="60d80-156">ja (standard)</span><span class="sxs-lookup"><span data-stu-id="60d80-156">yes (default)</span></span>     |   <span data-ttu-id="60d80-157">ja</span><span class="sxs-lookup"><span data-stu-id="60d80-157">yes</span></span>      |
|<span data-ttu-id="60d80-158">Datadisk</span><span class="sxs-lookup"><span data-stu-id="60d80-158">Data disk</span></span>     |   <span data-ttu-id="60d80-159">ja (standard)</span><span class="sxs-lookup"><span data-stu-id="60d80-159">yes (default)</span></span>      |  <span data-ttu-id="60d80-160">ja</span><span class="sxs-lookup"><span data-stu-id="60d80-160">yes</span></span>       |  <span data-ttu-id="60d80-161">ja</span><span class="sxs-lookup"><span data-stu-id="60d80-161">yes</span></span>       |
|<span data-ttu-id="60d80-162">Tillfällig disk</span><span class="sxs-lookup"><span data-stu-id="60d80-162">Temporary disk</span></span>     |  <span data-ttu-id="60d80-163">nej</span><span class="sxs-lookup"><span data-stu-id="60d80-163">no</span></span>       |   <span data-ttu-id="60d80-164">nej</span><span class="sxs-lookup"><span data-stu-id="60d80-164">no</span></span>      |   <span data-ttu-id="60d80-165">nej</span><span class="sxs-lookup"><span data-stu-id="60d80-165">no</span></span>      |

> [!NOTE]
> <span data-ttu-id="60d80-166">Alternativen för diskcachelagring kan inte ändras för virtuella datorer i L-serien och B-serien.</span><span class="sxs-lookup"><span data-stu-id="60d80-166">Disk caching options can't be changed for L-Series and B-series virtual machines.</span></span>

## <a name="performance-considerations-for-azure-vm-disk-caching"></a><span data-ttu-id="60d80-167">Prestandaöverväganden för diskcachelagring för virtuella Azure-datorer</span><span class="sxs-lookup"><span data-stu-id="60d80-167">Performance considerations for Azure VM disk caching</span></span>

<span data-ttu-id="60d80-168">Hur kan då dina cacheinställningar påverka prestanda för de arbetsbelastningar som körs på virtuella Azure-datorer?</span><span class="sxs-lookup"><span data-stu-id="60d80-168">So how can your cache settings affect the performance of your workloads running on Azure VMs?</span></span>

### <a name="os-disk"></a><span data-ttu-id="60d80-169">OS-disk</span><span class="sxs-lookup"><span data-stu-id="60d80-169">OS disk</span></span>

<span data-ttu-id="60d80-170">För en OS-disk för en virtuell dator är standardbeteendet att använda cachelagring i läget Läsa/skriva.</span><span class="sxs-lookup"><span data-stu-id="60d80-170">For a VM OS disk, the default behavior is to use the cache in Read/write mode.</span></span> <span data-ttu-id="60d80-171">Om du har program som lagrar datafiler på OS-disken och programmen utför många slumpmässiga läs-/skrivåtgärder till datafiler bör du överväga att flytta de filerna till en datadisk som har cachelagring inaktiverat.</span><span class="sxs-lookup"><span data-stu-id="60d80-171">If you have applications that store data files on the OS disk, and the applications do lots of random read/write operations to data files, consider moving those files to a data disk, which has the caching turned off.</span></span> <span data-ttu-id="60d80-172">Det beror på att om läsningskön inte innehåller sekventiella läsåtgärder så finns det få eller inga fördelar med cachelagring.</span><span class="sxs-lookup"><span data-stu-id="60d80-172">Why is that Well, if the read queue does not contain sequential reads, caching will be of little or no benefit.</span></span> <span data-ttu-id="60d80-173">Arbetet med att underhålla cacheminnet som om data vore sekventiella kan minska diskprestanda.</span><span class="sxs-lookup"><span data-stu-id="60d80-173">The overhead of maintaining the cache, as if the data was sequential, can reduce disk performance.</span></span>

### <a name="data-disks"></a><span data-ttu-id="60d80-174">Datadiskar</span><span class="sxs-lookup"><span data-stu-id="60d80-174">Data disks</span></span>

<span data-ttu-id="60d80-175">För prestandakänsliga program bör du använda datadiskar i stället för OS-disken.</span><span class="sxs-lookup"><span data-stu-id="60d80-175">For performance sensitive applications, you should use data disks, rather than the OS disk.</span></span> <span data-ttu-id="60d80-176">Med hjälp av separata diskar kan du konfigurera lämpliga cacheinställningar för varje disk.</span><span class="sxs-lookup"><span data-stu-id="60d80-176">Using separate disks allows you to configure the appropriate cache settings for each disk.</span></span>

<span data-ttu-id="60d80-177">Exempel: om du aktiverar **Skrivskyddad** cachelagring för datadiskarna för virtuella Azure-datorer som kör SQL Server kan det resultera i avsevärda prestandaförbättringar.</span><span class="sxs-lookup"><span data-stu-id="60d80-177">For example, on Azure VMs running SQL Server, enabling **Read-only** caching on the data disks (for regular and TempDB data), can result in significant performance improvements.</span></span> <span data-ttu-id="60d80-178">Loggfiler å andra sidan är bra kandidater för datadiskar utan cachelagring.</span><span class="sxs-lookup"><span data-stu-id="60d80-178">Log files, on the other hand, are good candidates for data disks with no caching.</span></span>

> [!WARNING]
> <span data-ttu-id="60d80-179">När du ändrar cacheinställningen för en Azure-disk så frånkopplas och återansluts måldisken.</span><span class="sxs-lookup"><span data-stu-id="60d80-179">Changing the cache setting of an Azure disk detaches and re-attaches the target disk.</span></span> <span data-ttu-id="60d80-180">Om det är operativsystemdisken startas den virtuella datorn om.</span><span class="sxs-lookup"><span data-stu-id="60d80-180">If it's the operating system disk, the VM is restarted.</span></span> <span data-ttu-id="60d80-181">Stoppa alla program/tjänster som kan påverkas av det här avbrottet innan du ändrar inställningen för diskcachelagring.</span><span class="sxs-lookup"><span data-stu-id="60d80-181">Stop all applications/services that might be affected by this disruption before changing the disk cache setting.</span></span>
>
>