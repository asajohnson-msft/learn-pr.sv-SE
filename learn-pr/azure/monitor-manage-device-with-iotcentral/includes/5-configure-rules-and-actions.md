<span data-ttu-id="3d0dd-101">Du har anslutit en kaffebryggare till programmet Azure IoT Central, vilket aktiverar utbyte av data som gör att du kan övervaka och hantera kaffebryggaren.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-101">You have connected your coffee machine to the Azure IoT Central application, enabling the exchange of data that allows you to monitor and manage your coffee machine.</span></span> <span data-ttu-id="3d0dd-102">I den här modulen skapar du regler som utlöser åtgärder när vattentemperaturen i kaffebryggaren ligger utanför det normala området.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-102">In this module, you create rules that trigger actions when the water temperature of the coffee machine is out of the normal range.</span></span> <span data-ttu-id="3d0dd-103">Åtgärderna är antingen e-postmeddelanden eller mobilmeddelanden beroende på om kaffebryggaren har en gällande garanti.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-103">The actions are either emails or mobile notifications depending on whether or not the machine is under warranty.</span></span> <span data-ttu-id="3d0dd-104">Om du vill lägga till Microsoft Flow som en åtgärd behöver du en Azure-prenumeration.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-104">To add Microsoft Flow as an action, you need an Azure subscription.</span></span> <span data-ttu-id="3d0dd-105">Om du inte har en Azure-prenumeration är det valfritt att lägga till Microsoft Flow som en åtgärd.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-105">If you do not have an Azure subscription, adding Microsoft Flow as an action is optional.</span></span>

## <a name="create-rules-in-iot-central-with-email-as-the-action"></a><span data-ttu-id="3d0dd-106">Skapa regler i IoT Central med e-postmeddelanden som åtgärd</span><span class="sxs-lookup"><span data-stu-id="3d0dd-106">Create rules in IoT Central with Email as the action</span></span>
<span data-ttu-id="3d0dd-107">Azure IoT Central har en inbyggd funktion för att skicka meddelanden.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-107">Azure IoT Central has its native email capabilities to send notifications.</span></span> <span data-ttu-id="3d0dd-108">I det här scenariot gäller följande: om kaffebryggaren ligger utanför temperaturintervallet och inte har en gällande garanti, skickas ett e-postmeddelande från IoT Central till kundens underhållsavdelning.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-108">In this scenario, if the coffee machine is outside the optimal temperature range and is not protected by the warranty, an email is sent by IoT Central to the client’s maintenance department.</span></span>

<span data-ttu-id="3d0dd-109">Lägg till följande två regler när kaffebryggarens garanti har upphört att gälla och vattentemperaturen ligger utanför det optimala intervallet.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-109">Add the following two rules when the coffee machine warranty has expired and the water temperature is outside the optimal range.</span></span> <span data-ttu-id="3d0dd-110">När du är klar väljer du **Spara**.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-110">When you're finished, choose **Save**.</span></span> 

> [!NOTE]
> <span data-ttu-id="3d0dd-111">När villkoren tillämpas måste alla instruktioner vara sanna för att reglerna ska köras.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-111">When conditions are applied, all statements have to be true for the rules to be executed.</span></span> <span data-ttu-id="3d0dd-112">Om villkoret är en ”eller”-instruktion som i det här scenariot (t.ex. den optimala temperaturen är lägre än 90 grader Celsius eller högre än 98 grader Celsius, med en garanti som upphört) ska instruktionen delas i två regler, som visas här.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-112">If your condition is an "or" statement as in this scenario (e.g. the optimal temperature is less than 90 Celsius or greater than 98 Celsius while the warranty has expired), split the statement into two rules as shown here.</span></span>

1. <span data-ttu-id="3d0dd-113">Namnge regeln: kaffebryggarens vatten är för kallt (garantin har upphört)</span><span class="sxs-lookup"><span data-stu-id="3d0dd-113">Name the rule: Coffee Maker Water Too Cold (Expired)</span></span>

    <span data-ttu-id="3d0dd-114">Lägg till villkor:</span><span class="sxs-lookup"><span data-stu-id="3d0dd-114">Add the conditions:</span></span>      
    * <span data-ttu-id="3d0dd-115">Enhetens garanti har upphört är lika med 1</span><span class="sxs-lookup"><span data-stu-id="3d0dd-115">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="3d0dd-116">Vattentemperaturen är lägre än kaffebryggarens lägsta temperatur ![med hjälp av regel](../images/5-flow-g.png)</span><span class="sxs-lookup"><span data-stu-id="3d0dd-116">Water Temperature is less than Coffee Makers Min Temperature ![Using Rule](../images/5-flow-g.png)</span></span>

1. <span data-ttu-id="3d0dd-117">Namnge regeln: kaffebryggarens vatten är för varmt (garantin har upphört)</span><span class="sxs-lookup"><span data-stu-id="3d0dd-117">Name the rule: Coffee Maker Water Too Hot (Expired)</span></span>

    <span data-ttu-id="3d0dd-118">Lägg till villkor:</span><span class="sxs-lookup"><span data-stu-id="3d0dd-118">Add the conditions:</span></span>      
    * <span data-ttu-id="3d0dd-119">Enhetens garanti har upphört är lika med 1</span><span class="sxs-lookup"><span data-stu-id="3d0dd-119">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="3d0dd-120">Vattentemperaturen är högre än kaffebryggarens högsta temperatur ![med hjälp av regel](../images/5-flow-k.png)</span><span class="sxs-lookup"><span data-stu-id="3d0dd-120">Water Temperature is greater than Coffee Makers Max Temperature ![Using Rule](../images/5-flow-k.png)</span></span>     

1. <span data-ttu-id="3d0dd-121">För att lägga till en **Åtgärd** rullar du ned på panelen Konfigurera telemetriregel och väljer +-tecknet bredvid Åtgärder. Välj sedan **E-post**</span><span class="sxs-lookup"><span data-stu-id="3d0dd-121">To add an **Action**, scroll down on the Configure Telemetry Rule panel and choose the + next to Actions, then choose **Email**</span></span>

1. <span data-ttu-id="3d0dd-122">Lägg till den e-postadress som du använde för att logga in i programmet IoT Central för att definiera åtgärden.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-122">To define the action, add the email address that you used to sign in to the IoT Central application.</span></span> <span data-ttu-id="3d0dd-123">Lägg till aviseringsmeddelandet när vattentemperaturen är för varm: ”Kaffebryggarens vatten är för varmt.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-123">Add the notification message when the water temperature is too hot: "Coffee maker's water is too hot.</span></span> <span data-ttu-id="3d0dd-124">Underhåll krävs.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-124">Maintenance is required.</span></span>  <span data-ttu-id="3d0dd-125">Garanti har upphört att gälla.”</span><span class="sxs-lookup"><span data-stu-id="3d0dd-125">Warranty has expired."</span></span> <span data-ttu-id="3d0dd-126">Upprepa samma steg för situationen där vattentemperaturen är för kall.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-126">Repeat the same steps for when the water temperature is too cold.</span></span> <span data-ttu-id="3d0dd-127">Lägg till meddelandet: ”Kaffebryggarens vatten är för kallt.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-127">Add the message: "Coffee maker's water is too cold.</span></span> <span data-ttu-id="3d0dd-128">Underhåll krävs.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-128">Maintenance is required.</span></span>  <span data-ttu-id="3d0dd-129">Garanti har upphört att gälla.”</span><span class="sxs-lookup"><span data-stu-id="3d0dd-129">Warranty has expired."</span></span>

1. <span data-ttu-id="3d0dd-130">Välj **Spara**.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-130">Choose **Save**.</span></span> <span data-ttu-id="3d0dd-131">Regeln finns på sidan Regler:</span><span class="sxs-lookup"><span data-stu-id="3d0dd-131">Your rule is listed on the Rules page:</span></span>

1. <span data-ttu-id="3d0dd-132">För att utlösa regeln väntar du tills temperaturen hamnar utanför intervallet eller så kan du med avsikt ange en temperatur utanför det optimala intervallet i inställningarna.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-132">To trigger the rule, you can wait for the temperature to go out of the range or you can purposely set the temperature out of the optimal range in settings.</span></span> <span data-ttu-id="3d0dd-133">När du får ett e-postmeddelande ska du komma ihåg att inaktivera regeln för att undvika att överbelasta din inkorg med e-postmeddelanden från Azure IoT Central.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-133">Once you begin to receive email notification, remember to disable the rule to avoid flooding your Inbox with emails from Azure IoT Central.</span></span> 

> [!NOTE]
> <span data-ttu-id="3d0dd-134">Inaktivera reglerna när du är klar med verifieringen för att undvika att överbelasta inkorgen med e-postmeddelanden.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-134">Turn off the rules once you are done with validation to avoid flooding your Inbox with emails.</span></span> 

## <a name="create-rules-in-iot-central-with-microsoft-flow-as-the-action"></a><span data-ttu-id="3d0dd-135">Skapa regler i IoT Central med Microsoft Flow som åtgärd</span><span class="sxs-lookup"><span data-stu-id="3d0dd-135">Create rules in IoT Central with Microsoft Flow as the action</span></span>

<span data-ttu-id="3d0dd-136">Microsoft Flow automatiserar arbetsflöden för många program.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-136">Microsoft Flow automates workflows across many applications.</span></span> <span data-ttu-id="3d0dd-137">Det är en av de åtgärder som kan utlösas när en regel utlöses i IoT Central.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-137">It’s one of the actions that can be triggered when a rule is fired in IoT Central.</span></span> <span data-ttu-id="3d0dd-138">I det här scenariot skickar Microsoft Flow ett mobilmeddelande till en lokal tekniker när kaffebryggaren når ett visst tröskelvärde för temperaturen och garantin gäller.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-138">In this scenario, Microsoft Flow sends a mobile notification to a local technician when the coffee machine reaches certain temperature threshold and is under warranty.</span></span> <span data-ttu-id="3d0dd-139">Gå till **Regler** och konfigurera villkor och lägg till ett flöde som en åtgärd när regeln utlöses.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-139">Navigate to **Rules** to configure conditions and add a Flow as an action when the rule is fired.</span></span> 
 
> [!NOTE]
> <span data-ttu-id="3d0dd-140">Den här övningen är valfri om du inte har en Azure-prenumeration och kan aktivera Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-140">This exercise is optional if you do not have an Azure subscription to turn on Microsoft Flow.</span></span>

<span data-ttu-id="3d0dd-141">Lägg till följande regler när kaffebryggaren har en gällande garanti.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-141">Add the following rules when the coffee machine is under warranty.</span></span> 

1. <span data-ttu-id="3d0dd-142">Namnge regeln: kaffebryggarens vatten är för kallt (garanti)</span><span class="sxs-lookup"><span data-stu-id="3d0dd-142">Name the rule: Coffee Maker Water Too Cold (Warranty)</span></span>

    <span data-ttu-id="3d0dd-143">Lägg till villkor:</span><span class="sxs-lookup"><span data-stu-id="3d0dd-143">Add the conditions:</span></span>      
    * <span data-ttu-id="3d0dd-144">Enhetens garanti har upphört är lika med 0</span><span class="sxs-lookup"><span data-stu-id="3d0dd-144">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="3d0dd-145">Vattentemperaturen är lägre än kaffebryggarens lägsta temperatur ![med hjälp av regel](../images/5-flow-l.png)</span><span class="sxs-lookup"><span data-stu-id="3d0dd-145">Water Temperature is less than Coffee Makers Min Temperature ![Using Rule](../images/5-flow-l.png)</span></span>

1. <span data-ttu-id="3d0dd-146">Namnge regeln: kaffebryggarens vatten är för varmt (garanti)</span><span class="sxs-lookup"><span data-stu-id="3d0dd-146">Name the rule: Coffee Maker Water Too Hot (Warranty)</span></span>

    <span data-ttu-id="3d0dd-147">Lägg till villkor:</span><span class="sxs-lookup"><span data-stu-id="3d0dd-147">Add the conditions:</span></span>      
    * <span data-ttu-id="3d0dd-148">Enhetens garanti har upphört är lika med 0</span><span class="sxs-lookup"><span data-stu-id="3d0dd-148">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="3d0dd-149">Vattentemperaturen är högre än kaffebryggarens högsta temperatur ![med hjälp av regel](../images/5-flow-h.png)</span><span class="sxs-lookup"><span data-stu-id="3d0dd-149">Water Temperature is greater than Coffee Makers Max Temperature ![Using Rule](../images/5-flow-h.png)</span></span>

1. <span data-ttu-id="3d0dd-150">När du har sparat regelvillkoren kan du välja Microsoft Flow som en ny åtgärd när kaffebryggaren har en gällande garanti.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-150">After you save the rule conditions, choose Microsoft Flow as a new action when the coffee maker is under warranty.</span></span> <span data-ttu-id="3d0dd-151">En ny flik eller ett fönster bör öppnas i din webbläsare, som tar dig till Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-151">A new tab or window should open in your browser, taking you to Microsoft Flow.</span></span> <span data-ttu-id="3d0dd-152">Du hamnar på en översiktssida som visar en IoT Central-anslutningsapp som ansluter till en anpassad åtgärd.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-152">You land on an overview page showing an IoT Central connector connecting to a custom action.</span></span> <span data-ttu-id="3d0dd-153">Välj **Fortsätt**.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-153">Choose **Continue**.</span></span> 

    <span data-ttu-id="3d0dd-154">Du kommer till Microsoft Flow-designverktyget och kan skapa arbetsflödet.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-154">You are taken to the Microsoft Flow designer to build your workflow.</span></span> <span data-ttu-id="3d0dd-155">Arbetsflödet har en IoT Central-utlösare som redan har programmet och regeln ifyllda.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-155">The workflow has an IoT Central trigger that has your Application and Rule already filled in.</span></span>

    <span data-ttu-id="3d0dd-156">Nu kan du lägga till alla åtgärder du vill i arbetsflödet.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-156">At this point, you can add any action you want to your workflow.</span></span> <span data-ttu-id="3d0dd-157">Som ett exempel kan vi skicka ett mobilmeddelande.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-157">As an example, let's send a mobile notification.</span></span> <span data-ttu-id="3d0dd-158">Sök efter meddelandet och välj Meddelanden – Send me a mobile notification (Skicka ett mobilmeddelande).</span><span class="sxs-lookup"><span data-stu-id="3d0dd-158">Search for notification, and choose Notifications - Send me a mobile notification.</span></span>

    <span data-ttu-id="3d0dd-159">I åtgärden fyller du i fältet Text med vad du vill att meddelandet ska innehålla.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-159">In the action, fill in the Text field with what you want your notification to say.</span></span> <span data-ttu-id="3d0dd-160">Du kan inkludera dynamiskt innehåll från IoT Central-regeln och skicka med viktig information, till exempel enhets-ID och namn.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-160">You can include Dynamic content from your IoT Central rule, passing along important information such as device ID and name.</span></span>
    <span data-ttu-id="3d0dd-161">![Använda Microsoft Flow som en åtgärd](../images/5-flow-f.png)</span><span class="sxs-lookup"><span data-stu-id="3d0dd-161">![Using Microsoft Flow as an action](../images/5-flow-f.png)</span></span>

1. <span data-ttu-id="3d0dd-162">När du har konfigurerat arbetsflödet i Microsoft Flow laddar du ned [Flow-appen](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) från Microsoft Store till din mobila enhet.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-162">Once you've set up the workflow in Microsoft Flow, download the [Flow app](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) from Microsoft Store to your mobile device.</span></span> <span data-ttu-id="3d0dd-163">Logga in med samma konto som du använde för att konfigurera flödet i Flow-webbappen.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-163">Sign in using the same account that you used to set up the flow in the Flow web app.</span></span> <span data-ttu-id="3d0dd-164">I testsyfte ställer du in den optimala temperaturen utanför intervallet för att utlösa regeln.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-164">For testing purpose, set the optimal temperature out of range to trigger the rule.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="3d0dd-165">Enhetsegenskap: Enhetens garanti har upphört (1 för upphört eller 0 för gällande garanti i enhetskoden) genereras slumpmässigt av enheten och skickas sedan av enheten till programmet Azure IoT Central.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-165">Device Property: Device Warranty Expired (1 for expired or 0 for under warranty in the device code) is randomly generated by the device and then sent by the device to the Azure IoT Central application.</span></span> <span data-ttu-id="3d0dd-166">I testsyfte kanske du vill styra värdet för garantins upphörande (1 eller 0). Starta då om simulatorn tills du får önskat tillstånd för garantin för att utlösa den åtgärd som du testar.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-166">For testing purpose, if you'd like to control Device Warranty Expired (1 or 0), reboot your simulator until you receive the intended warranty state to trigger the action that you're testing.</span></span> <span data-ttu-id="3d0dd-167">För att få ett mobilmeddelande ska du starta om simulatorn tills du ser att enhetens garanti har upphört är lika med 0 i konsolloggen.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-167">To receive a mobile notification, reboot your simulator until you see that Device Warranty Expired is 0 in the console log.</span></span> 

    <span data-ttu-id="3d0dd-168">Efter ett par minuter visas meddelandet i Flow-mobilappen.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-168">After several minutes, notification appears in the Flow mobile app.</span></span>

    ![Använda Microsoft Flow som en åtgärd](../images/5-flow-a.png)

## <a name="summary"></a><span data-ttu-id="3d0dd-170">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="3d0dd-170">Summary</span></span>
<span data-ttu-id="3d0dd-171">Du har lärt dig att skapa regler i IoT Central och utlöst åtgärder som exempelvis ett e-postmeddelande eller ett mobilmeddelande via Microsoft Flow när regeln utlöses.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-171">You’ve learned to create rules in IoT Central and triggered actions such as an email or a mobile notification through Microsoft Flow when the rule is fired.</span></span> <span data-ttu-id="3d0dd-172">I det här fallet när kaffebryggarens vattentemperatur ligger utanför det optimala intervallet, skickas meddelanden till antingen en reparatör eller kunden beroende på tillståndet för garantin.</span><span class="sxs-lookup"><span data-stu-id="3d0dd-172">In this case, when the water temperature of the coffee machine is out of the optimal range, notifications are sent to either a repair technician or the client depending on the state of the warranty.</span></span> 


