<span data-ttu-id="36cc6-101">Anta att du planerar arkitekturen för ditt musikdelningsprogram.</span><span class="sxs-lookup"><span data-stu-id="36cc6-101">Suppose you are planning the architecture for your music-sharing application.</span></span> <span data-ttu-id="36cc6-102">Du vill se till att musikfilerna överförs till webb-API:n på ett tillförlitligt sätt från mobilappen.</span><span class="sxs-lookup"><span data-stu-id="36cc6-102">You want to choose ensure that music files are uploaded to the web API reliably from the mobile app.</span></span>

<span data-ttu-id="36cc6-103">Eftersom du har förstått att den här kommunikationen ska vara ett meddelande, måste du välja om du ska använda Azure Storage-köer eller Azure Service Bus. Båda kan användas för att lagra köade meddelanden som väntar på bearbetning.</span><span class="sxs-lookup"><span data-stu-id="36cc6-103">Having understood that this communication should be a message, you must choose whether to use Azure Storage queues or Service Bus, both of which can be used to store queues of messages as they await processing.</span></span>

## <a name="delivery-guarantees"></a><span data-ttu-id="36cc6-104">Leveransgarantier</span><span class="sxs-lookup"><span data-stu-id="36cc6-104">Delivery Guarantees</span></span>

<span data-ttu-id="36cc6-105">Kösystem garanterar vanligtvis att varje meddelande i kön levereras till en målkomponent.</span><span class="sxs-lookup"><span data-stu-id="36cc6-105">Queuing systems usually guarantee delivery of each message in the queue to a destination component.</span></span> <span data-ttu-id="36cc6-106">Dessa garantier kan dock fungera på olika sätt:</span><span class="sxs-lookup"><span data-stu-id="36cc6-106">However, these guarantees can take different approaches:</span></span>

- <span data-ttu-id="36cc6-107">**Leverans minst en gång.**</span><span class="sxs-lookup"><span data-stu-id="36cc6-107">**At-Least-Once Delivery.**</span></span> <span data-ttu-id="36cc6-108">Den här metoden garanterar att varje meddelande levereras till minst en av de komponenter som hämtar meddelanden från kön.</span><span class="sxs-lookup"><span data-stu-id="36cc6-108">In this approach, each message is guaranteed to be delivered to at least one of the components that retrieve messages from the queue.</span></span> <span data-ttu-id="36cc6-109">Observera att i vissa fall kan det hända att samma meddelande levereras mer än en gång.</span><span class="sxs-lookup"><span data-stu-id="36cc6-109">Note, however, that in certain circumstances, it is possible that the same message may be delivered more than once.</span></span> <span data-ttu-id="36cc6-110">Om det till exempel finns två instanser av en webbapp som hämtar meddelanden från en kö, skickas vanligtvis varje meddelande till endast en av dessa instanser.</span><span class="sxs-lookup"><span data-stu-id="36cc6-110">For example, if there are two instances of a web app retrieving messages from a queue, ordinarily each message goes to only one of those instances.</span></span> <span data-ttu-id="36cc6-111">Men om det tar lång tid för en instans att bearbeta meddelandet och en tidsgräns går ut, kan meddelandet skickas till den andra instansen också.</span><span class="sxs-lookup"><span data-stu-id="36cc6-111">However, if one instance takes a long time to process the message, and a time-out expires, the message may be sent to the other instance as well.</span></span> <span data-ttu-id="36cc6-112">Webbappkoden bör utformas med den här möjligheten i åtanke.</span><span class="sxs-lookup"><span data-stu-id="36cc6-112">Your web app code should be designed with this possibility in mind.</span></span>
- <span data-ttu-id="36cc6-113">**Leverans högst en gång.**</span><span class="sxs-lookup"><span data-stu-id="36cc6-113">**At-Most-Once Delivery.**</span></span> <span data-ttu-id="36cc6-114">Med den här metoden kan man inte garantera att varje meddelande levereras och det finns en mycket liten risk att det inte kommer fram alls.</span><span class="sxs-lookup"><span data-stu-id="36cc6-114">In this approach, each message is not guaranteed to be delivered and there is a very small chance that it may not arrive.</span></span> <span data-ttu-id="36cc6-115">Det finns dock ingen risk att meddelandet levereras två gånger som med alternativet Leverans minst en gång.</span><span class="sxs-lookup"><span data-stu-id="36cc6-115">However, there is no chance that the message will be delivered twice as with At-Least-Once delivery.</span></span>
- <span data-ttu-id="36cc6-116">**Först-in-först-ut (FIFO).**</span><span class="sxs-lookup"><span data-stu-id="36cc6-116">**First-In-First-Out (FIFO).**</span></span> <span data-ttu-id="36cc6-117">I de flesta meddelandesystem lämnar meddelanden vanligtvis kön i samma ordning som de har lagts till, men du bör fundera på om den här ordningen ska vara garanterad.</span><span class="sxs-lookup"><span data-stu-id="36cc6-117">In most messaging system, messages usually leave the queue in the same order in which they were added but you should consider whether this order is guaranteed.</span></span> <span data-ttu-id="36cc6-118">Om det distribuerade programmet kräver att meddelanden behandlas i exakt rätt ordning, måste du välja ett kösystem med FIFO-säkerhet.</span><span class="sxs-lookup"><span data-stu-id="36cc6-118">If your distributed application requires that messages are processed in precisely the correct order, you must choose a queue system that includes a FIFO guarantee.</span></span>

## <a name="transactions"></a><span data-ttu-id="36cc6-119">Transaktioner</span><span class="sxs-lookup"><span data-stu-id="36cc6-119">Transactions</span></span>

<span data-ttu-id="36cc6-120">Vissa nära relaterade grupper av meddelanden kan orsaka problem om leveransen misslyckas för ett av meddelandena i gruppen.</span><span class="sxs-lookup"><span data-stu-id="36cc6-120">Some closely related groups of messages may cause problems when delivery fails for one message in the group.</span></span>

<span data-ttu-id="36cc6-121">Tänk dig exempelvis ett e-handelsprogram.</span><span class="sxs-lookup"><span data-stu-id="36cc6-121">For example, consider an e-commerce application.</span></span> <span data-ttu-id="36cc6-122">När användaren klickar på ”Köp”-knappen skickas ett meddelande med orderinformationen, tillsammans med ett meddelande som innehåller kreditkortsinformationen.</span><span class="sxs-lookup"><span data-stu-id="36cc6-122">When the user clicks the "Buy" button, a message with the order details is sent along with a message with the credit card details.</span></span> <span data-ttu-id="36cc6-123">Om kreditkortsmeddelandet inte levereras kan ordern komma att skickas utan att någon betalning gjorts.</span><span class="sxs-lookup"><span data-stu-id="36cc6-123">If the credit card message is not delivered, the order may be dispatched without payment.</span></span>

<span data-ttu-id="36cc6-124">Du kan undvika dessa typer av problem genom att gruppera de två meddelandena i en transaktion.</span><span class="sxs-lookup"><span data-stu-id="36cc6-124">You can avoid these kinds of problems by grouping the two messages into a transaction.</span></span> <span data-ttu-id="36cc6-125">Transaktionerna lyckas eller misslyckas som en enda enhet.</span><span class="sxs-lookup"><span data-stu-id="36cc6-125">Transactions succeed or fail as a single unit.</span></span> <span data-ttu-id="36cc6-126">Om leveransen av kreditkortsinformationen misslyckas, kommer även orderinformationen att göra det.</span><span class="sxs-lookup"><span data-stu-id="36cc6-126">If the credit card details message delivery fails then so will the order details message.</span></span>

## <a name="when-to-use-storage-queues"></a><span data-ttu-id="36cc6-127">När ska man använda Storage-köer?</span><span class="sxs-lookup"><span data-stu-id="36cc6-127">When to use Storage queues</span></span>

<span data-ttu-id="36cc6-128">Köer används för meddelanden, men inte händelser.</span><span class="sxs-lookup"><span data-stu-id="36cc6-128">Queues are used for messages but not events.</span></span>

<span data-ttu-id="36cc6-129">Azure Storage-konton innehåller köer som kan användas av distribuerade program som enkla tillfälliga lagringsplatser för meddelanden.</span><span class="sxs-lookup"><span data-stu-id="36cc6-129">Azure Storage Accounts include queues, which can be used by distributed applications as simple temporary storage locations for messages.</span></span> <span data-ttu-id="36cc6-130">En källkomponent kan lägga till ett meddelande i kön.</span><span class="sxs-lookup"><span data-stu-id="36cc6-130">A source component can add a message to the queue.</span></span> <span data-ttu-id="36cc6-131">Målkomponenter hämtar det meddelande som ligger först i kön för bearbetning.</span><span class="sxs-lookup"><span data-stu-id="36cc6-131">Destination components retrieve the message at the front of the queue for processing.</span></span> <span data-ttu-id="36cc6-132">Sådana köer ökar tillförlitligheten för meddelanden eftersom det vid hög efterfrågan kan innebära att meddelanden får vänta tills en målkomponent är redo att bearbeta dem.</span><span class="sxs-lookup"><span data-stu-id="36cc6-132">Such queues increase the reliability of the message exchange because, at times of high demand, messages can simply wait until a destination component is ready to process them.</span></span>

<span data-ttu-id="36cc6-133">Köer ingår också som en del av Azure Service Bus-meddelandefunktionen.</span><span class="sxs-lookup"><span data-stu-id="36cc6-133">Queues are also provided as part of Azure Service Bus Messaging.</span></span> <span data-ttu-id="36cc6-134">Om du har valt att använda en kö i Azure för en viss kommunikation, måste du bestämma om du vill använda en Storage-kö eller en Service Bus-kö.</span><span class="sxs-lookup"><span data-stu-id="36cc6-134">If you have decided to use a queue in Azure for a specific communication, you must decide whether to use a Storage queue or a Service Bus queue.</span></span>

<span data-ttu-id="36cc6-135">Tänk på följande när du ska göra detta val:</span><span class="sxs-lookup"><span data-stu-id="36cc6-135">To make this choice, consider the following questions:</span></span>

- <span data-ttu-id="36cc6-136">Behöver du en garanti om leverans högst en gång?</span><span class="sxs-lookup"><span data-stu-id="36cc6-136">Do you need an At-Most-Once delivery guarantee?</span></span>
- <span data-ttu-id="36cc6-137">Behöver du FIFO-säkerhet?</span><span class="sxs-lookup"><span data-stu-id="36cc6-137">Do you need a FIFO guarantee?</span></span>
- <span data-ttu-id="36cc6-138">Behöver du gruppera meddelanden i transaktioner?</span><span class="sxs-lookup"><span data-stu-id="36cc6-138">Do you need to group messages into transactions?</span></span>
- <span data-ttu-id="36cc6-139">Behöver du lagra meddelanden som är större än 64 KB?</span><span class="sxs-lookup"><span data-stu-id="36cc6-139">Do you need to store messages larger than 64KB?</span></span>

<span data-ttu-id="36cc6-140">Om svaret på någon av dessa frågor är ja måste du använda en Service Bus-kö.</span><span class="sxs-lookup"><span data-stu-id="36cc6-140">If the answer to any of these questions is yes, you must choose to use a Service Bus queue.</span></span>

<span data-ttu-id="36cc6-141">Tänk dessutom på följande:</span><span class="sxs-lookup"><span data-stu-id="36cc6-141">In addition consider:</span></span>

- <span data-ttu-id="36cc6-142">Behöver du serverloggar för alla meddelanden som skickas via kön?</span><span class="sxs-lookup"><span data-stu-id="36cc6-142">Do you need server-side logs of all messages that pass through the queue?</span></span>
- <span data-ttu-id="36cc6-143">Förväntar du dig att kön kommer att överskrida 80 GB i storlek?</span><span class="sxs-lookup"><span data-stu-id="36cc6-143">Do you expect the queue to exceed 80GB in size?</span></span>

<span data-ttu-id="36cc6-144">Om svaret på någon av dessa frågor är ja måste du välja en Storage-kö.</span><span class="sxs-lookup"><span data-stu-id="36cc6-144">If the answer to any of these questions is yes, you must choose to use a Storage queue.</span></span>

## <a name="summary"></a><span data-ttu-id="36cc6-145">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="36cc6-145">Summary</span></span>

<span data-ttu-id="36cc6-146">En kö är en enkel tillfällig lagringsplats för meddelanden som skickas mellan komponenterna i ett distribuerat program.</span><span class="sxs-lookup"><span data-stu-id="36cc6-146">A queue is a simple temporary storage location for messages sent between the components of a distributed application.</span></span> <span data-ttu-id="36cc6-147">Använd en kö till att ordna meddelanden och hantera oväntade toppar i efterfrågan.</span><span class="sxs-lookup"><span data-stu-id="36cc6-147">Use a queue to organize message and gracefully handle unpredictable surges in demand.</span></span>

<span data-ttu-id="36cc6-148">Använd Azure Storage-köer om du vill ha ett enkelt kösystem som är lätt att koda.</span><span class="sxs-lookup"><span data-stu-id="36cc6-148">Use Azure Storage queues when you want a simple and easy-to-code queue system.</span></span> <span data-ttu-id="36cc6-149">Använd Azure Service Bus-köer för mer avancerade behov.</span><span class="sxs-lookup"><span data-stu-id="36cc6-149">For more advanced needs, use Azure Service Bus queues.</span></span>