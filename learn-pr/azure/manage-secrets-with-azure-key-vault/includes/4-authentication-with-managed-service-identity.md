<span data-ttu-id="9af08-101">Azure Key Vault använder **Azure Active Directory** till att autentisera användare och program som försöker få åtkomst till ett valv.</span><span class="sxs-lookup"><span data-stu-id="9af08-101">Azure Key Vault uses **Azure Active Directory** to authenticate users and applications that try to access a vault.</span></span> <span data-ttu-id="9af08-102">För att ge vår webbapp åtkomst till valvet, måste vi först registrera appen med Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="9af08-102">To grant our web application access to the vault, we first need to register our app with Azure Active Directory.</span></span> <span data-ttu-id="9af08-103">Vid registreringen skapas en identitet för appen.</span><span class="sxs-lookup"><span data-stu-id="9af08-103">Registering creates an identity for the app.</span></span> <span data-ttu-id="9af08-104">När vi har en identitet kan vi tilldela valvbehörigheter till den.</span><span class="sxs-lookup"><span data-stu-id="9af08-104">Once we have an identity, we can assign vault permissions to it.</span></span>

<span data-ttu-id="9af08-105">Appar och användare autentiserar till Key Vault med hjälp av en Azure Active Directory-autentiseringstoken.</span><span class="sxs-lookup"><span data-stu-id="9af08-105">Apps and users authenticate to Key Vault using an Azure Active Directory authentication token.</span></span> <span data-ttu-id="9af08-106">För att få en token från Azure Active Directory krävs en hemlighet eller ett certifikat, eftersom alla med en token kan använda programidentiteten för att komma åt samtliga hemligheter i valvet.</span><span class="sxs-lookup"><span data-stu-id="9af08-106">Getting a token from Azure Active Directory requires a secret or certificate, because anyone with a token could use the application identity to access all of the secrets in the vault.</span></span>

<span data-ttu-id="9af08-107">Våra programhemligheter är säkra i valvet, men vi måste ha en hemlighet eller ett certifikat utanför valvet för att komma åt dem!</span><span class="sxs-lookup"><span data-stu-id="9af08-107">Our application secrets are secure in the vault, but we still need to keep a secret or certificate outside of the vault in order to access them!</span></span> <span data-ttu-id="9af08-108">Det här problemet kallas för *startproblem* och Azure har en lösning.</span><span class="sxs-lookup"><span data-stu-id="9af08-108">This problem is called the *bootstrapping problem*, and Azure has a solution for it.</span></span>

## <a name="managed-service-identity"></a><span data-ttu-id="9af08-109">Hanterad tjänstidentitet</span><span class="sxs-lookup"><span data-stu-id="9af08-109">Managed Service Identity</span></span>

<span data-ttu-id="9af08-110">*Hanterad tjänstidentitet* (MSI) är en funktion i Azure App Service som din app kan använda för att få åtkomst till Key Vault och andra Azure-tjänster utan att behöva hantera en enda hemlighet.</span><span class="sxs-lookup"><span data-stu-id="9af08-110">*Managed Service Identity* (MSI) is a feature of Azure App Service that your app can use to access Key Vault and other Azure services without having to manage even a single secret.</span></span> <span data-ttu-id="9af08-111">Det är enklare och säkrare att använda MSI än att hantera en hemlighet själv.</span><span class="sxs-lookup"><span data-stu-id="9af08-111">Using MSI is simpler and more secure than managing a secret yourself.</span></span>

<span data-ttu-id="9af08-112">När du aktiverar MSI aktiverar Azure en separat tokenbeviljande REST-tjänst som ska användas specifikt av din app.</span><span class="sxs-lookup"><span data-stu-id="9af08-112">When you enable MSI, Azure activates a separate token-granting REST service specifically for use by your app.</span></span> <span data-ttu-id="9af08-113">När appen begär en token från MSI-tokentjänsten, kontaktar tjänsten Azure Active Directory för att få en token för MSI-identiteten. Den skickas sedan till din app för användning med Key Vault.</span><span class="sxs-lookup"><span data-stu-id="9af08-113">When your app requests a token from the MSI token service, the service contacts Azure Active Directory to get a token for the MSI identity and hands it back to your app for use with Key Vault.</span></span> <span data-ttu-id="9af08-114">Den viktigaste delen i det här arbetsflödet är vilken metod din app har för att autentisera till MSI-tokentjänsten &mdash; i stället för att kräva en hemlighet eller ett certifikat som du behöver hantera i din konfiguration, använder din app en hemlighet som Azure lägger in på ett säkert sätt i sina miljövariabler när den startas.</span><span class="sxs-lookup"><span data-stu-id="9af08-114">The most important part of this workflow is the way that your app authenticates to the MSI token service &mdash; instead of requiring a secret or certificate you need to manage in your configuration, your app uses a secret that Azure securely injects into its environment variables when it starts up.</span></span> <span data-ttu-id="9af08-115">Du behöver inte hantera eller lagra denna hemlighet någonstans.</span><span class="sxs-lookup"><span data-stu-id="9af08-115">You don't need to manage or store this secret value anywhere.</span></span> <span data-ttu-id="9af08-116">Inget utanför appen kan komma åt den här hemligheten eller MSI-tokentjänstens slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="9af08-116">Nothing outside of your app can access this secret or the MSI token service endpoint.</span></span>

<span data-ttu-id="9af08-117">MSI registrerar även din app i Azure Active Directory åt dig och tar bort registreringen om du inaktiverar MSI eller tar bort appen.</span><span class="sxs-lookup"><span data-stu-id="9af08-117">MSI also registers your app in Azure Active Directory for you, and will delete the registration if you disable MSI or delete the app.</span></span>

<span data-ttu-id="9af08-118">MSI är tillgängligt i alla utgåvor av Azure Active Directory, inklusive den kostnadsfria versionen som ingår i en Azure-prenumeration.</span><span class="sxs-lookup"><span data-stu-id="9af08-118">MSI is available in all editions of Azure Active Directory, including the Free edition included with an Azure subscription.</span></span> <span data-ttu-id="9af08-119">Att använda MSI i App Service medför inte någon extra kostnad och kräver inte någon konfiguration. Det kan aktiveras eller inaktiveras i en app när som helst.</span><span class="sxs-lookup"><span data-stu-id="9af08-119">Using it in App Service has no extra cost and requires no configuration, and it can be enabled or disabled on an app at any time.</span></span>

> [!NOTE]
> <span data-ttu-id="9af08-120">MSI stöds inte för Linux eller behållarwebbappar för närvarande.</span><span class="sxs-lookup"><span data-stu-id="9af08-120">MSI is not currently supported for Linux or Container web apps.</span></span>

<span data-ttu-id="9af08-121">När du aktiverar MSI krävs bara ett enda Azure CLI-kommando utan konfiguration.</span><span class="sxs-lookup"><span data-stu-id="9af08-121">Enabling MSI requires only a single Azure CLI command with no configuration.</span></span> <span data-ttu-id="9af08-122">Vi ska göra detta i enhet 5 när vi skapar en App Service-app och distribuerar den till Azure.</span><span class="sxs-lookup"><span data-stu-id="9af08-122">We'll do it in unit 5 when we set up an App Service app and deploy to Azure.</span></span> <span data-ttu-id="9af08-123">Innan dess ska vi dock använda vår kunskap om MSI till att skriva koden för appen.</span><span class="sxs-lookup"><span data-stu-id="9af08-123">Before that, though, we're going to apply our knowledge of MSI to write the code for our app.</span></span>