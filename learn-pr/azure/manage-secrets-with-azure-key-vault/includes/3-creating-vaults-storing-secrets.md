## <a name="creating-key-vaults-for-your-applications"></a><span data-ttu-id="3742c-101">Skapa nyckelvalv för dina program</span><span class="sxs-lookup"><span data-stu-id="3742c-101">Creating Key Vaults for your applications</span></span>

<span data-ttu-id="3742c-102">Det är bra att ge skapa ett separat valv för varje distributionsmiljö för varje program, till exempel utveckling, testning och produktion.</span><span class="sxs-lookup"><span data-stu-id="3742c-102">Good practice is to create a separate vault for each deployment environment of each of your applications, such as development, test, and production.</span></span> <span data-ttu-id="3742c-103">Det är möjligt att använda valv för att dela hemligheter mellan flera appar, men risken för en angripare som får läsåtkomst till ett valv ökar med antalet hemligheter i valvet.</span><span class="sxs-lookup"><span data-stu-id="3742c-103">It's possible to use vaults to share secrets across multiple apps, but the impact of an attacker gaining read access to a vault increases with the number of secrets in the vault.</span></span>

> [!TIP]
> <span data-ttu-id="3742c-104">Om du använder samma namn för hemligheter i olika miljöer för ett program, kommer den enda miljöspecifika konfiguration som behöver ändras i din app vara valvets URL.</span><span class="sxs-lookup"><span data-stu-id="3742c-104">If you use the same names for secrets across different environments for an application, the only environment-specific configuration that has to change in your app is the vault URL.</span></span>

<span data-ttu-id="3742c-105">Det krävs ingen inledande konfiguration för att skapa ett valv.</span><span class="sxs-lookup"><span data-stu-id="3742c-105">Creating a vault requires no initial configuration.</span></span> <span data-ttu-id="3742c-106">Din användaridentitet beviljas automatiskt en full uppsättning med behörigheter för hemlighetshantering och du kan börja lägga till hemligheter omedelbart.</span><span class="sxs-lookup"><span data-stu-id="3742c-106">Your user identity is automatically granted the full set of secret management permissions and you can start adding secrets immediately.</span></span> <span data-ttu-id="3742c-107">När du har ett valv kan du lägga till och hantera hemligheter från alla Azure-administrationsgränssnitt, inklusive Azure-portalen, Azure CLI och Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="3742c-107">Once you have a vault, adding and managing secrets can be done from any Azure administrative interface, including the Azure portal, the Azure CLI, and Azure PowerShell.</span></span> <span data-ttu-id="3742c-108">När du konfigurerar programmet till att använda valvet måste du tilldela korrekt behörighet, vilket vi tittar närmare på i nästa enhet.</span><span class="sxs-lookup"><span data-stu-id="3742c-108">When you set up your application to use the vault, you'll need to assign the correct permissions to it; we'll see that in the next unit.</span></span>

## <a name="vault-authentication-and-permissions"></a><span data-ttu-id="3742c-109">Valvautentisering och behörigheter</span><span class="sxs-lookup"><span data-stu-id="3742c-109">Vault authentication and permissions</span></span>

<span data-ttu-id="3742c-110">API:n för Azure Key Vaults använder Azure Active Directory till att autentisera användare och program.</span><span class="sxs-lookup"><span data-stu-id="3742c-110">Azure Key Vault's API uses Azure Active Directory to authenticate users and applications.</span></span> <span data-ttu-id="3742c-111">Principerna för valvåtkomst baseras på *åtgärder* och tillämpas i hela valvet.</span><span class="sxs-lookup"><span data-stu-id="3742c-111">Vault access policies are based on *actions*, and are applied across an entire vault.</span></span> <span data-ttu-id="3742c-112">Till exempel kan ett program med behörigheterna **Hämta** (läsa hemligheter), **Lista** (göra en lista med namnen på alla hemligheter) och **Ange** (skapa eller uppdatera hemligheter) för ett valv skapa hemligheter, visa en lista med alla namn på hemligheterna, samt hämta och ange alla hemligheter i det valvet.</span><span class="sxs-lookup"><span data-stu-id="3742c-112">For example, an application with **Get** (read secret values), **List** (list names of all secrets), and **Set** (create or update secret values) permissions to a vault is able to create secrets, list all secret names, and get and set all secret values in that vault.</span></span>

<span data-ttu-id="3742c-113">*Alla* åtgärder som utförs i ett valv kräver autentisering och auktorisering &mdash; det finns inget sätt att bevilja någon form av anonym åtkomst.</span><span class="sxs-lookup"><span data-stu-id="3742c-113">*All* actions performed on a vault require authentication and authorization &mdash; there is no way to grant any kind of anonymous access.</span></span>

> [!TIP]
> <span data-ttu-id="3742c-114">När valvåtkomst beviljas för utvecklare och appar, beviljas endast den minsta uppsättningen behörigheter som krävs.</span><span class="sxs-lookup"><span data-stu-id="3742c-114">When granting vault access to developers and apps, grant only the minimum set of permissions needed.</span></span> <span data-ttu-id="3742c-115">Tack vare behörighetsbegränsningarna kan man undvika incidenter på grund av kodbuggar och minska effekterna vid stulna autentiseringsuppgifter eller skadlig kod som sprids till din app.</span><span class="sxs-lookup"><span data-stu-id="3742c-115">Permissions restrictions help avoid accidents caused by code bugs and reduce the impact of stolen credentials or malicious code injected into your app.</span></span>

<span data-ttu-id="3742c-116">Utvecklare kommer vanligtvis bara behöva behörigheterna **Hämta** och **Lista** i ett valvs utvecklingsmiljö.</span><span class="sxs-lookup"><span data-stu-id="3742c-116">Developers will usually only need **Get** and **List** permissions to a development-environment vault.</span></span> <span data-ttu-id="3742c-117">En erfaren utvecklare behöver fullständig behörighet till valvet för att kunna ändra och lägga till hemligheter när det behövs.</span><span class="sxs-lookup"><span data-stu-id="3742c-117">A lead or senior developer will need full permissions to the vault to change and add secrets when necessary.</span></span> <span data-ttu-id="3742c-118">Fullständig behörighet till produktionsmiljövalv är vanligtvis reserverade för erfaren personal.</span><span class="sxs-lookup"><span data-stu-id="3742c-118">Full permissions to production-environment vaults are typically reserved for senior operations staff.</span></span>

<span data-ttu-id="3742c-119">För appar krävs vanligtvis endast behörigheten **Hämta**.</span><span class="sxs-lookup"><span data-stu-id="3742c-119">For apps, typically only **Get** permissions are required.</span></span> <span data-ttu-id="3742c-120">Vissa appar kan kräva **Lista**, beroende på hur appen implementeras.</span><span class="sxs-lookup"><span data-stu-id="3742c-120">Some apps may require **List** depending on the way the app is implemented.</span></span> <span data-ttu-id="3742c-121">Appen som vi implementerar i den här modulövningen kräver behörigheten **Lista**, på grund av den teknik som används för att läsa hemligheter från valvet.</span><span class="sxs-lookup"><span data-stu-id="3742c-121">The app we'll implement in this module's exercise requires the **List** permission because of the technique it uses to read secrets from the vault.</span></span>

## <a name="exercise"></a><span data-ttu-id="3742c-122">Övning</span><span class="sxs-lookup"><span data-stu-id="3742c-122">Exercise</span></span>

<span data-ttu-id="3742c-123">På grund av alla problem som företaget har haft med programhemligheter, har ledningen bett dig att skapa en liten startapp som hjälper de andra utvecklarna.</span><span class="sxs-lookup"><span data-stu-id="3742c-123">Given all the trouble the company's been having with application secrets, management has asked you to create a small starter app to set the other developers on the right path.</span></span> <span data-ttu-id="3742c-124">Appen ska visa metodtips för att hantera hemligheter så enkelt och säkert som möjligt.</span><span class="sxs-lookup"><span data-stu-id="3742c-124">The app needs to demonstrate best practices for managing secrets as simply and securely as possible.</span></span>

<span data-ttu-id="3742c-125">Till att börja med måste du skapa ett valv och lagra en hemlighet.</span><span class="sxs-lookup"><span data-stu-id="3742c-125">To start, you'll create a vault and store one secret.</span></span>

### <a name="create-a-resource-group"></a><span data-ttu-id="3742c-126">Skapa en resursgrupp</span><span class="sxs-lookup"><span data-stu-id="3742c-126">Create a resource group</span></span>
<!---TODO: Update for sandbox?--->

<span data-ttu-id="3742c-127">Skapa en resursgrupp med namnet `keyvault-exercise-group` för alla resurser i den här kursdelen.</span><span class="sxs-lookup"><span data-stu-id="3742c-127">Create a resource group called `keyvault-exercise-group` for all of the resources In this unit.</span></span> <span data-ttu-id="3742c-128">I slutet av den här modulen tar vi bort resursgruppen för att kunna rensa allt på samma gång.</span><span class="sxs-lookup"><span data-stu-id="3742c-128">At the end of this module, we'll be deleting this resource group to cleanup everything at once.</span></span> <span data-ttu-id="3742c-129">Vi använder `eastus` som plats för allt innehåll i den här kursdelen.</span><span class="sxs-lookup"><span data-stu-id="3742c-129">We'll use `eastus` as the location for everything In this unit.</span></span>

<span data-ttu-id="3742c-130">Använd Azure Cloud Shell-terminalen till höger och kör följande Azure CLI-kommando.</span><span class="sxs-lookup"><span data-stu-id="3742c-130">Use the Azure Cloud Shell terminal on the right to run the following Azure CLI command.</span></span> <span data-ttu-id="3742c-131">Detta skapar resursgruppen i din prenumeration.</span><span class="sxs-lookup"><span data-stu-id="3742c-131">This will create the resource group in your subscription.</span></span>

```azurecli
az group create --name keyvault-exercise-group --location eastus
```

### <a name="create-the-vault-and-store-the-secret-in-it"></a><span data-ttu-id="3742c-132">Skapa valvet och lagra hemligheten i det</span><span class="sxs-lookup"><span data-stu-id="3742c-132">Create the vault and store the secret in it</span></span>

<span data-ttu-id="3742c-133">Därefter skapar vi valvet och lagrar hemligheten i det.</span><span class="sxs-lookup"><span data-stu-id="3742c-133">Next, we'll create the vault and store our secret in it.</span></span>

<span data-ttu-id="3742c-134">**Namn på nyckelvalv måste vara globalt unika, så du måste välja ett unikt namn**.</span><span class="sxs-lookup"><span data-stu-id="3742c-134">**Key Vault names must be globally unique, so you'll need to pick a unique name**.</span></span> <span data-ttu-id="3742c-135">Valvnamn måste vara mellan 3 och 24 tecken långa och får endast innehålla alfanumeriska tecken och streck.</span><span class="sxs-lookup"><span data-stu-id="3742c-135">Vault names must be 3-24 characters long and contain only alphanumeric characters and dashes.</span></span>

```azurecli
az keyvault create --name <your-unique-vault-name> --resource-group keyvault-exercise-group --location eastus
```

<span data-ttu-id="3742c-136">När det är klart visas JSON-utdata med en beskrivning av det nya valvet.</span><span class="sxs-lookup"><span data-stu-id="3742c-136">When it finishes, you'll see JSON output describing the new vault.</span></span>

<span data-ttu-id="3742c-137">Lägg nu till hemligheten: Vår hemlighet får namnet **SecretPassword** med värdet **reindeer_flotilla**.</span><span class="sxs-lookup"><span data-stu-id="3742c-137">Now add the secret: our secret will be named **SecretPassword** with a value of **reindeer_flotilla**.</span></span>

```azurecli
az keyvault secret set --name SecretPassword --value reindeer_flotilla --vault-name <your-unique-vault-name>
```

<span data-ttu-id="3742c-138">Anteckna valvnamnet &mdash; du kommer att behöva det senare.</span><span class="sxs-lookup"><span data-stu-id="3742c-138">Make a note of the vault name &mdash; you'll be needing it again soon.</span></span>

<span data-ttu-id="3742c-139">Vi ska skriva koden för våra program strax, men först måste vi ta reda på lite mer om hur vår app ska autentiseras till ett valv.</span><span class="sxs-lookup"><span data-stu-id="3742c-139">We'll write the code for our application shortly, but first we need to learn a little bit about how our app is going to authenticate to a vault.</span></span>