<span data-ttu-id="de3e4-101">Du har anslutit en kaffebryggare till Azure IoT Central-programmet, vilket aktiverar utbyte av data som gör att du kan övervaka och hantera kaffebryggaren.</span><span class="sxs-lookup"><span data-stu-id="de3e4-101">You have connected your coffee machine to the Azure IoT Central application, enabling the exchange of data that allows you to monitor and manage your coffee machine.</span></span> <span data-ttu-id="de3e4-102">I den här enheten skapar du regler som utlöser åtgärder när vattentemperaturen i kaffebryggaren ligger utanför det normala området.</span><span class="sxs-lookup"><span data-stu-id="de3e4-102">In this unit, you create rules that trigger actions when the water temperature of the coffee machine is outside the normal range.</span></span> <span data-ttu-id="de3e4-103">Åtgärderna är antingen e-postmeddelanden eller mobilmeddelanden beroende på om kaffebryggaren har en gällande garanti.</span><span class="sxs-lookup"><span data-stu-id="de3e4-103">The actions are either emails or mobile notifications depending on whether or not the machine is under warranty.</span></span> <span data-ttu-id="de3e4-104">Om du vill lägga till Microsoft Flow som en åtgärd behöver du en Azure-prenumeration.</span><span class="sxs-lookup"><span data-stu-id="de3e4-104">To add Microsoft Flow as an action, you need an Azure subscription.</span></span> <span data-ttu-id="de3e4-105">Om du inte har en Azure-prenumeration är det valfritt att lägga till Microsoft Flow som en åtgärd.</span><span class="sxs-lookup"><span data-stu-id="de3e4-105">If you do not have an Azure subscription, adding Microsoft Flow as an action is optional.</span></span>

## <a name="create-rules-in-iot-central-with-email-as-the-action"></a><span data-ttu-id="de3e4-106">Skapa regler i IoT Central med e-postmeddelanden som åtgärd</span><span class="sxs-lookup"><span data-stu-id="de3e4-106">Create rules in IoT Central with Email as the action</span></span>
<span data-ttu-id="de3e4-107">Azure IoT Central har en inbyggd funktion för att skicka meddelanden.</span><span class="sxs-lookup"><span data-stu-id="de3e4-107">Azure IoT Central has its native email capabilities to send notifications.</span></span> <span data-ttu-id="de3e4-108">I det här scenariot gäller följande: om kaffebryggaren ligger utanför temperaturintervallet och inte har en gällande garanti skickas ett e-postmeddelande från IoT Central till kundens underhållsavdelning.</span><span class="sxs-lookup"><span data-stu-id="de3e4-108">In this scenario, if the coffee machine is outside the optimal temperature range and is not protected by the warranty, an email is sent by IoT Central to the client’s maintenance department.</span></span>

<span data-ttu-id="de3e4-109">Navigera till sidan **Regler** för övningarna i den här enheten.</span><span class="sxs-lookup"><span data-stu-id="de3e4-109">Navigate to the **Rules** page for the exercises in this unit.</span></span> <span data-ttu-id="de3e4-110">Välj **+ Ny regel** och sedan **Telemetri**.</span><span class="sxs-lookup"><span data-stu-id="de3e4-110">Select **+ New Rule**, then **Telemetry**.</span></span> <span data-ttu-id="de3e4-111">Lägg till följande två regler när kaffebryggarens garanti har upphört att gälla och vattentemperaturen ligger utanför det optimala intervallet.</span><span class="sxs-lookup"><span data-stu-id="de3e4-111">Add the following two rules when the coffee machine warranty has expired and the water temperature is outside the optimal range.</span></span> <span data-ttu-id="de3e4-112">När du är klar väljer du **Spara**.</span><span class="sxs-lookup"><span data-stu-id="de3e4-112">When you're finished, choose **Save**.</span></span> 

> [!NOTE]
> <span data-ttu-id="de3e4-113">När villkoren tillämpas måste alla instruktioner vara sanna för att reglerna ska köras.</span><span class="sxs-lookup"><span data-stu-id="de3e4-113">When conditions are applied, all statements have to be true for the rules to be executed.</span></span> <span data-ttu-id="de3e4-114">Om villkoret är en ”eller”-instruktion som i det här scenariot (t.ex. den optimala temperaturen är lägre än eller större än de fördefinierade värdena, med en garanti som upphört) ska instruktionen delas i två regler, som visas här.</span><span class="sxs-lookup"><span data-stu-id="de3e4-114">If your condition is an "or" statement as in this scenario (e.g. the optimal temperature is less or greater than the predefined values while the warranty has expired), split the statement into two rules as shown here.</span></span>

1. <span data-ttu-id="de3e4-115">Namnge regeln: kaffebryggarens vatten är för kallt (garantin har upphört)</span><span class="sxs-lookup"><span data-stu-id="de3e4-115">Name the rule: Coffee Maker Water Too Cold (Expired)</span></span>

    <span data-ttu-id="de3e4-116">Lägg till villkor:</span><span class="sxs-lookup"><span data-stu-id="de3e4-116">Add the conditions:</span></span>      
    * <span data-ttu-id="de3e4-117">Enhetens garanti har upphört är lika med 1</span><span class="sxs-lookup"><span data-stu-id="de3e4-117">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="de3e4-118">Vattentemperaturen är lägre än kaffebryggarens lägsta temperatur</span><span class="sxs-lookup"><span data-stu-id="de3e4-118">Water Temperature is less than Coffee Makers Min Temperature</span></span>

    ![Använda regeln](../images/5-flow-a.png)

1. <span data-ttu-id="de3e4-120">Namnge regeln: kaffebryggarens vatten är för varmt (garantin har upphört)</span><span class="sxs-lookup"><span data-stu-id="de3e4-120">Name the rule: Coffee Maker Water Too Hot (Expired)</span></span>

    <span data-ttu-id="de3e4-121">Lägg till villkor:</span><span class="sxs-lookup"><span data-stu-id="de3e4-121">Add the conditions:</span></span>      
    * <span data-ttu-id="de3e4-122">Enhetens garanti har upphört är lika med 1</span><span class="sxs-lookup"><span data-stu-id="de3e4-122">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="de3e4-123">Vattentemperaturen är högre än kaffebryggarens högsta temperatur</span><span class="sxs-lookup"><span data-stu-id="de3e4-123">Water Temperature is greater than Coffee Makers Max Temperature</span></span>

1. <span data-ttu-id="de3e4-124">För att lägga till en **Åtgärd** rullar du ned på panelen Konfigurera telemetriregel och väljer **+** intill Åtgärder. Välj sedan **E-post**.</span><span class="sxs-lookup"><span data-stu-id="de3e4-124">To add an **Action**, scroll down on the Configure Telemetry Rule panel and choose **+** next to Actions, then choose **Email**.</span></span>

1. <span data-ttu-id="de3e4-125">Lägg till den e-postadress som du använde för att logga in i programmet IoT Central för att definiera åtgärden.</span><span class="sxs-lookup"><span data-stu-id="de3e4-125">To define the action, add the email address that you used to sign in to the IoT Central application.</span></span> <span data-ttu-id="de3e4-126">Lägg till aviseringsmeddelandet när vattentemperaturen är för varm: ”Kaffebryggarens vatten är för varmt.</span><span class="sxs-lookup"><span data-stu-id="de3e4-126">Add the notification message when the water temperature is too hot: "Coffee maker's water is too hot.</span></span> <span data-ttu-id="de3e4-127">Underhåll krävs.</span><span class="sxs-lookup"><span data-stu-id="de3e4-127">Maintenance is required.</span></span>  <span data-ttu-id="de3e4-128">Garantin har upphört att gälla.”</span><span class="sxs-lookup"><span data-stu-id="de3e4-128">Warranty has expired."</span></span> <span data-ttu-id="de3e4-129">Upprepa samma steg för situationen där vattentemperaturen är för kall.</span><span class="sxs-lookup"><span data-stu-id="de3e4-129">Repeat the same steps for when the water temperature is too cold.</span></span> <span data-ttu-id="de3e4-130">Lägg till meddelandet: ”Kaffebryggarens vatten är för kallt.</span><span class="sxs-lookup"><span data-stu-id="de3e4-130">Add the message: "Coffee maker's water is too cold.</span></span> <span data-ttu-id="de3e4-131">Underhåll krävs.</span><span class="sxs-lookup"><span data-stu-id="de3e4-131">Maintenance is required.</span></span>  <span data-ttu-id="de3e4-132">Garantin har upphört att gälla.”</span><span class="sxs-lookup"><span data-stu-id="de3e4-132">Warranty has expired."</span></span>

1. <span data-ttu-id="de3e4-133">Välj **Spara**.</span><span class="sxs-lookup"><span data-stu-id="de3e4-133">Choose **Save**.</span></span> <span data-ttu-id="de3e4-134">Regeln finns på sidan Regler.</span><span class="sxs-lookup"><span data-stu-id="de3e4-134">Your rule is listed on the Rules page.</span></span>

1. <span data-ttu-id="de3e4-135">För att utlösa regeln anger du optimal temperatur i Inställningar utanför det intervall som du angav under Egenskaper.</span><span class="sxs-lookup"><span data-stu-id="de3e4-135">To trigger the rule, set the optimal temperature in Settings outside the range that you specified under Properties.</span></span> <span data-ttu-id="de3e4-136">När du är klar med verifieringen stänger du av reglerna för att undvika att överbelasta inkorgen med e-postmeddelanden.</span><span class="sxs-lookup"><span data-stu-id="de3e4-136">Once you are done with the validation, turn off the rules to avoid flooding your Inbox with emails.</span></span> 

## <a name="create-rules-in-iot-central-with-microsoft-flow-as-the-action"></a><span data-ttu-id="de3e4-137">Skapa regler i IoT Central med Microsoft Flow som åtgärd</span><span class="sxs-lookup"><span data-stu-id="de3e4-137">Create rules in IoT Central with Microsoft Flow as the action</span></span>

<span data-ttu-id="de3e4-138">Microsoft Flow automatiserar arbetsflöden för många program.</span><span class="sxs-lookup"><span data-stu-id="de3e4-138">Microsoft Flow automates workflows across many applications.</span></span> <span data-ttu-id="de3e4-139">Det är en av de åtgärder som kan utlösas när en regel utlöses i IoT Central.</span><span class="sxs-lookup"><span data-stu-id="de3e4-139">It’s one of the actions that can be triggered when a rule is fired in IoT Central.</span></span> <span data-ttu-id="de3e4-140">I det här scenariot skickar Microsoft Flow ett mobilmeddelande till en lokal tekniker när kaffebryggaren når ett visst tröskelvärde för temperaturen och garantin gäller.</span><span class="sxs-lookup"><span data-stu-id="de3e4-140">In this scenario, Microsoft Flow sends a mobile notification to a local technician when the coffee machine reaches certain temperature threshold and is under warranty.</span></span> <span data-ttu-id="de3e4-141">Gå till **Regler** och konfigurera villkor och lägg till ett flöde som en åtgärd när regeln utlöses.</span><span class="sxs-lookup"><span data-stu-id="de3e4-141">Navigate to **Rules** to configure conditions and add a Flow as an action when the rule is fired.</span></span> 
 
> [!NOTE]
> <span data-ttu-id="de3e4-142">Den här övningen är valfri om du inte har en Azure-prenumeration att använda för att aktivera Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="de3e4-142">This exercise is optional if you do not have an Azure subscription to turn on Microsoft Flow.</span></span>


### <a name="extend-your-iot-central-trial-to-30-days"></a><span data-ttu-id="de3e4-143">Förläng din utvärdering med IoT Central till 30 dagar</span><span class="sxs-lookup"><span data-stu-id="de3e4-143">Extend your IoT Central trial to 30 days</span></span>

1. <span data-ttu-id="de3e4-144">Om du vill aktivera Microsoft Flow måste du utöka din utvärdering till 30 dagar.</span><span class="sxs-lookup"><span data-stu-id="de3e4-144">To turn on Microsoft Flow, you need to extend your trial to 30 days.</span></span> <span data-ttu-id="de3e4-145">För att göra det väljer du **Extend Trial to 30 days** (Utöka utvärderingen till 30 dagar) på sidan Fakturering och väljer en Azure Active Directory- och Azure-prenumeration.</span><span class="sxs-lookup"><span data-stu-id="de3e4-145">To do so, select **Extend Trial to 30 days** on the Billing page, choose an Azure Active Directory and Azure subscription.</span></span> <span data-ttu-id="de3e4-146">Med en Azure-prenumeration kan du skapa instanser av Azure-tjänster.</span><span class="sxs-lookup"><span data-stu-id="de3e4-146">An Azure subscription enables you to create instances of Azure services.</span></span> <span data-ttu-id="de3e4-147">Azure IoT Central hittar automatiskt alla Azure-prenumerationer som du har åtkomst till och visar dem i listrutan.</span><span class="sxs-lookup"><span data-stu-id="de3e4-147">Azure IoT Central automatically finds all the Azure Subscriptions you have access to, and displays them in the drop-down.</span></span>
    
1. <span data-ttu-id="de3e4-148">Om du inte har en Azure-prenumeration kan du skapa en på [registreringssidan för Azure](https://aka.ms/createazuresubscription).</span><span class="sxs-lookup"><span data-stu-id="de3e4-148">If you don’t have an Azure subscription, you can create one on the [Azure sign-up page](https://aka.ms/createazuresubscription).</span></span> <span data-ttu-id="de3e4-149">När du har skapat en Azure-prenumeration går du tillbaka till sidan **Application Manager** (Programhanterare).</span><span class="sxs-lookup"><span data-stu-id="de3e4-149">After you create the Azure subscription, navigate back to the **Application Manager** page.</span></span> <span data-ttu-id="de3e4-150">Din nya prenumeration visas i listrutan **Azure-prenumeration**.</span><span class="sxs-lookup"><span data-stu-id="de3e4-150">Your new subscription appears in the **Azure Subscription** drop-down.</span></span>
        

### <a name="add-the-following-rules-when-the-coffee-machine-is-under-warranty"></a><span data-ttu-id="de3e4-151">Lägg till följande regler när kaffebryggaren har en gällande garanti.</span><span class="sxs-lookup"><span data-stu-id="de3e4-151">Add the following rules when the coffee machine is under warranty.</span></span> 

1. <span data-ttu-id="de3e4-152">Namnge regeln: Kaffebryggarens vatten är för kallt (garanti)</span><span class="sxs-lookup"><span data-stu-id="de3e4-152">Name the rule: Coffee Maker Water Too Cold (Warranty)</span></span>

    <span data-ttu-id="de3e4-153">Lägg till villkor:</span><span class="sxs-lookup"><span data-stu-id="de3e4-153">Add the conditions:</span></span>      
    * <span data-ttu-id="de3e4-154">Enhetens garanti har upphört är lika med 0</span><span class="sxs-lookup"><span data-stu-id="de3e4-154">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="de3e4-155">Vattentemperaturen är lägre än kaffebryggarens lägsta temperatur</span><span class="sxs-lookup"><span data-stu-id="de3e4-155">Water Temperature is less than Coffee Makers Min Temperature</span></span>

1. <span data-ttu-id="de3e4-156">Namnge regeln: Kaffebryggarens vatten är för varmt (garanti)</span><span class="sxs-lookup"><span data-stu-id="de3e4-156">Name the rule: Coffee Maker Water Too Hot (Warranty)</span></span>

    <span data-ttu-id="de3e4-157">Lägg till villkor:</span><span class="sxs-lookup"><span data-stu-id="de3e4-157">Add the conditions:</span></span>      
    * <span data-ttu-id="de3e4-158">Enhetens garanti har upphört är lika med 0</span><span class="sxs-lookup"><span data-stu-id="de3e4-158">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="de3e4-159">Vattentemperaturen är högre än kaffebryggarens högsta temperatur</span><span class="sxs-lookup"><span data-stu-id="de3e4-159">Water Temperature is greater than Coffee Makers Max Temperature</span></span>

1. <span data-ttu-id="de3e4-160">När du har sparat regelvillkoren väljer du Microsoft Flow som en ny åtgärd när kaffebryggaren har en gällande garanti.</span><span class="sxs-lookup"><span data-stu-id="de3e4-160">After you save the rule conditions, choose Microsoft Flow as a new action when the coffee maker is under warranty.</span></span> <span data-ttu-id="de3e4-161">En ny flik eller ett fönster bör öppnas i din webbläsare, som tar dig till Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="de3e4-161">A new tab or window should open in your browser, taking you to Microsoft Flow.</span></span> <span data-ttu-id="de3e4-162">Du hamnar på en översiktssida som visar en IoT Central-anslutningsapp som ansluter till en anpassad åtgärd.</span><span class="sxs-lookup"><span data-stu-id="de3e4-162">You land on an overview page showing an IoT Central connector connecting to a custom action.</span></span> <span data-ttu-id="de3e4-163">Välj **Fortsätt**.</span><span class="sxs-lookup"><span data-stu-id="de3e4-163">Choose **Continue**.</span></span> 

    <span data-ttu-id="de3e4-164">Du kommer till Microsoft Flow-designverktyget och kan skapa arbetsflödet.</span><span class="sxs-lookup"><span data-stu-id="de3e4-164">You are taken to the Microsoft Flow designer to build your workflow.</span></span> <span data-ttu-id="de3e4-165">Arbetsflödet har en IoT Central-utlösare som redan har programmet och regeln ifyllda.</span><span class="sxs-lookup"><span data-stu-id="de3e4-165">The workflow has an IoT Central trigger that has your Application and Rule already filled in.</span></span>

    <span data-ttu-id="de3e4-166">Nu kan du lägga till alla åtgärder du vill i arbetsflödet.</span><span class="sxs-lookup"><span data-stu-id="de3e4-166">At this point, you can add any action you want to your workflow.</span></span> <span data-ttu-id="de3e4-167">Som ett exempel kan vi skicka ett mobilmeddelande.</span><span class="sxs-lookup"><span data-stu-id="de3e4-167">As an example, let's send a mobile notification.</span></span> <span data-ttu-id="de3e4-168">Sök efter meddelandet och välj Meddelanden – Send me a mobile notification (Skicka ett mobilmeddelande).</span><span class="sxs-lookup"><span data-stu-id="de3e4-168">Search for notification, and choose Notifications - Send me a mobile notification.</span></span>

    <span data-ttu-id="de3e4-169">I åtgärden fyller du i fältet Text med vad du vill att meddelandet ska innehålla.</span><span class="sxs-lookup"><span data-stu-id="de3e4-169">In the action, fill in the Text field with what you want your notification to say.</span></span> <span data-ttu-id="de3e4-170">Du kan inkludera dynamiskt innehåll från IoT Central-regeln och skicka med viktig information, till exempel enhets-ID och namn.</span><span class="sxs-lookup"><span data-stu-id="de3e4-170">You can include Dynamic content from your IoT Central rule, passing along important information such as device ID and name.</span></span>
    
    ![Använda Microsoft Flow som en åtgärd](../images/5-flow-b.png)

1. <span data-ttu-id="de3e4-172">När du har konfigurerat arbetsflödet i Microsoft Flow laddar du ned [Flow-appen](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) från Microsoft Store till din mobila enhet.</span><span class="sxs-lookup"><span data-stu-id="de3e4-172">Once you've set up the workflow in Microsoft Flow, download the [Flow app](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) from Microsoft Store to your mobile device.</span></span> <span data-ttu-id="de3e4-173">Logga in med samma konto som du använde för att konfigurera flödet i Flow-webbappen.</span><span class="sxs-lookup"><span data-stu-id="de3e4-173">Sign in using the same account that you used to set up the flow in the Flow web app.</span></span> <span data-ttu-id="de3e4-174">I testsyfte ställer du in den optimala temperaturen utanför intervallet för att utlösa regeln.</span><span class="sxs-lookup"><span data-stu-id="de3e4-174">For testing purposes, set the optimal temperature out of range to trigger the rule.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="de3e4-175">Enhetsegenskap: Enhetens garanti har upphört (1 för upphört eller 0 för gällande garanti i enhetskoden) genereras slumpmässigt av enheten och skickas sedan av enheten till Azure IoT Central-programmet.</span><span class="sxs-lookup"><span data-stu-id="de3e4-175">Device Property: Device Warranty Expired (1 for expired or 0 for under warranty in the device code) is randomly generated by the device and then sent by the device to the Azure IoT Central application.</span></span> <span data-ttu-id="de3e4-176">I testsyfte vill du kanske styra värdet för garantins upphörande (1 eller 0). Starta då om kaffebryggaren tills du får önskat tillstånd för garantin för att utlösa den åtgärd som du testar.</span><span class="sxs-lookup"><span data-stu-id="de3e4-176">For testing purposes, if you'd like to control Device Warranty Expired (1 or 0), reboot your coffee machine until you receive the intended warranty state to trigger the action that you're testing.</span></span> <span data-ttu-id="de3e4-177">För att få ett mobilmeddelande ska du starta om kaffebryggaren tills du ser att enhetens garanti har upphört är lika med 0 i konsolloggen.</span><span class="sxs-lookup"><span data-stu-id="de3e4-177">To receive a mobile notification, reboot your coffee machine until you see that Device Warranty Expired is 0 in the console log.</span></span> 

    <span data-ttu-id="de3e4-178">Efter ett par minuter visas meddelanden i Flow-mobilappen.</span><span class="sxs-lookup"><span data-stu-id="de3e4-178">After several minutes, notifications appear in the Flow mobile app.</span></span>

    ![Använda Microsoft Flow som en åtgärd](../images/5-flow-c.png)

## <a name="summary"></a><span data-ttu-id="de3e4-180">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="de3e4-180">Summary</span></span>
<span data-ttu-id="de3e4-181">Du har lärt dig att skapa regler i IoT Central och utlöst åtgärder som exempelvis ett e-postmeddelande eller ett mobilmeddelande via Microsoft Flow när regeln utlöses.</span><span class="sxs-lookup"><span data-stu-id="de3e4-181">You’ve learned to create rules in IoT Central and triggered actions such as an email or a mobile notification through Microsoft Flow when the rule is fired.</span></span> <span data-ttu-id="de3e4-182">I det här fallet när kaffebryggarens vattentemperatur ligger utanför det optimala intervallet, skickas meddelanden till antingen en reparatör eller kunden beroende på statusen för garantin.</span><span class="sxs-lookup"><span data-stu-id="de3e4-182">In this case, when the water temperature of the coffee machine is out of the optimal range, notifications are sent to either a repair technician or the client depending on the status of the warranty.</span></span> 


