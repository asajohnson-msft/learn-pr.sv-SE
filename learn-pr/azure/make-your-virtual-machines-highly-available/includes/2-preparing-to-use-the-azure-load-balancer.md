<span data-ttu-id="c3bb1-101">Anta att ditt företag vill se om Azure Load Balancer stöder ditt ERP-program (Enterprise Resource Planning).</span><span class="sxs-lookup"><span data-stu-id="c3bb1-101">Suppose your company wants to see if the Azure Load Balancer will support your Enterprise Resource Planning (ERP) application.</span></span> <span data-ttu-id="c3bb1-102">Programmet har ett webbgränssnitt för användare och körs på flera servrar.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-102">Your application has a web interface for users and runs on multiple servers.</span></span> <span data-ttu-id="c3bb1-103">Varje server har en lokal kopia av ERP-databasen som är synkroniserad över alla servrar.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-103">Each server has a local copy of the ERP database which is synced across all servers.</span></span>

<span data-ttu-id="c3bb1-104">Här tittar vi på hur en lastbalanserare kan hjälpa dig att ge hög tillgänglighet för tjänster.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-104">Here, you will look at how a load balancer can help provide high availability of services.</span></span> <span data-ttu-id="c3bb1-105">Du identifierar skillnaden mellan alternativen Basic- och Standard-lastbalanserare och ser hur du skapar en lastbalanserare för virtuella Azure-datorer.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-105">You will identify the difference between the basic and standard load balancer options and see how to create a load balancer for Azure Virtual Machines.</span></span>

## <a name="what-is-load-balancing"></a><span data-ttu-id="c3bb1-106">Vad är belastningsutjämning?</span><span class="sxs-lookup"><span data-stu-id="c3bb1-106">What is load balancing?</span></span>

<span data-ttu-id="c3bb1-107">_Belastningsutjämning_ beskriver olika metoder för att distribuera arbetsbelastningar på flera enheter, till exempel beräkning, lagring och nätverk.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-107">_Load balancing_ describes various techniques for distributing workloads across multiple devices, such as compute, storage, and networking.</span></span> <span data-ttu-id="c3bb1-108">Målet med belastningsutjämning är att optimera användningen av flera resurser, att använda dessa resurser på det effektivaste sättet när en infrastruktur skalas ut samt att säkerställa att tjänster bevaras om vissa komponenter är inte tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-108">The goal of load balancing is to optimize the use of multiple resources, to make the most efficient use these resources as an infrastructure is scaled out, and to ensure services are maintained if some components are unavailable.</span></span>

<span data-ttu-id="c3bb1-109">Här går vi igenom stödet för belastningsutjämning för virtuella datorer (VM) i Azure.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-109">Here, will look at Azure's load balancing support for virtual machines (VMs).</span></span>

### <a name="what-is-high-availability"></a><span data-ttu-id="c3bb1-110">Vad är hög tillgänglighet?</span><span class="sxs-lookup"><span data-stu-id="c3bb1-110">What is High Availability?</span></span>

<span data-ttu-id="c3bb1-111">Hög tillgänglighet (HA) mäter möjligheten för program eller tjänster att förbli tillgängliga även om det uppstår fel i någon systemkomponent.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-111">High availability (HA) measures the ability of an application or service to remain accessible despite a failure in any system component.</span></span> <span data-ttu-id="c3bb1-112">I det ideala fallet sker ingen märkbar tjänstförlust.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-112">Ideally, there will be not be any noticeable loss of service.</span></span>

<span data-ttu-id="c3bb1-113">Belastningsutjämning är av stor vikt för leverans av hög tillgänglighet eftersom det gör att flera virtuella datorer fungerar som en pool med servrar.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-113">Load balancing is fundamental to the delivery of HA because it allows multiple VMs to act as a pool of servers.</span></span> <span data-ttu-id="c3bb1-114">Poolen kan fortsätta behandla begäranden även om några av de virtuella datorerna kraschar eller tas offline för underhåll.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-114">The pool can continue to service requests even if some VMs crash or are taken offline for maintenance.</span></span>

## <a name="what-is-the-azure-load-balancer"></a><span data-ttu-id="c3bb1-115">Vad är Azure Load Balancer?</span><span class="sxs-lookup"><span data-stu-id="c3bb1-115">What is the Azure Load Balancer?</span></span>

<span data-ttu-id="c3bb1-116">**Azure Load Balancer** är en Azure-tjänst som distribuerar inkommande begäranden mellan flera virtuella datorer i en pool.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-116">The **Azure Load Balancer** is an Azure service that distributes incoming requests across multiple VMs in a pool.</span></span> <span data-ttu-id="c3bb1-117">Den distribuerar inkommande nätverkstrafik mellan en uppsättning felfria virtuella datorer och undviker alla virtuella datorer som inte kan svara.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-117">It distributes incoming network traffic across a set of healthy VMs and avoids any VM that is not able to respond.</span></span>

<span data-ttu-id="c3bb1-118">Azure Load Balancer fungerar på lager 4 (TCP, UDP) i OSI:s 7-lagermodell.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-118">The Azure Load Balancer operates at Layer-4 (TCP, UDP) of the OSI 7-layer model.</span></span> <span data-ttu-id="c3bb1-119">Den kan konfigureras att stödja TCP- och UDP-tillämpningsscenarier där trafiken är inkommande till virtuella Azure-datorer samt utgående scenarier där andra Azure-tjänster skickar TCP- och UDP-trafik via virtuella Azure-datorer till externa slutpunkter.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-119">It can be configured to support TCP and UDP application scenarios where the traffic is inbound to Azure VMs, as well as outbound scenarios where other Azure services are passing TCP and UDP traffic out through Azure VMs to external endpoints.</span></span>

## <a name="public-vs-internal-load-balancers"></a><span data-ttu-id="c3bb1-120">Offentliga kontra interna lastbalanserare</span><span class="sxs-lookup"><span data-stu-id="c3bb1-120">Public vs. internal load balancers</span></span>

<span data-ttu-id="c3bb1-121">En Azure Load Balancer kan vara antingen _offentlig_ eller _intern_ beroende på källan för inkommande begäranden.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-121">An Azure Load Balancer can be either _public_ or _internal_ depending on the source of incoming requests.</span></span>

<span data-ttu-id="c3bb1-122">En **offentlig lastbalanserare** hanterar klientbegäranden som härrör utanför Azure-infrastrukturen.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-122">A **public load balancer** handles client requests from outside of your Azure infrastructure.</span></span> <span data-ttu-id="c3bb1-123">Lastbalanserarens offentliga IP-adress konfigureras automatiskt som lastbalanserarens serverdel när du skapar den offentliga IP-adressen och lastbalanserarens resurs.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-123">The public IP address of the load balancer is automatically configured as the load balancer's front end when you create the public IP and the load balancer resource.</span></span> <span data-ttu-id="c3bb1-124">Följande bild visar en offentlig lastbalanserare.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-124">The following illustration shows a public load balancer.</span></span>

![En bild som visar en offentlig lastbalanserare som distribuerar klientbegäranden från Internet till tre virtuella datorer i ett virtuellt nätverk.](../media-draft/2-public-load-balancer.png)

<span data-ttu-id="c3bb1-126">En **intern lastbalanserare** bearbetar begäranden som härrör inifrån ett virtuellt nätverk (eller via ett VPN).</span><span class="sxs-lookup"><span data-stu-id="c3bb1-126">An **internal load balancer** processes requests from within a virtual network (or through a VPN).</span></span> <span data-ttu-id="c3bb1-127">Den distribuerar begäranden till resurser inom det virtuella nätverket.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-127">It distributes requests to resources within that vNet.</span></span> <span data-ttu-id="c3bb1-128">Lastbalanseraren, klientdels-IP-adresser och virtuella nätverk är inte direkt åtkomliga från Internet.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-128">The load balancer, frontend IP addresses, and virtual networks are not directly accessible from the internet.</span></span> <span data-ttu-id="c3bb1-129">Följande bild visar en arkitektur som innehåller både en offentlig och en intern lastbalanserare.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-129">The following illustration shows an architecture containing both a public and internal load balancer.</span></span> <span data-ttu-id="c3bb1-130">Den offentliga lastbalanseraren hanterar externa begäranden medan den interna lastbalanseraren vidarebefordrar begärandena till de interna virtuella datorerna och databaserna för bearbetning.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-130">The public load balancer handles external requests while the internal load balancer forwards the requests to the internal VMs and databases for processing.</span></span>

![En bild som visar en offentlig lastbalanserare som vidarebefordrar klientbegäranden till en intern lastbalanserare.](../media-draft/2-internal-load-balancer.png)

## <a name="how-does-the-azure-load-balancer-work"></a><span data-ttu-id="c3bb1-134">Hur fungerar Azure Load Balancer?</span><span class="sxs-lookup"><span data-stu-id="c3bb1-134">How does the Azure Load Balancer work?</span></span>

<span data-ttu-id="c3bb1-135">Azure Load Balancer använder information som konfigureras i **regler** och **hälsoavsökningar** för att avgöra hur ny inkommande trafik som tas emot i lastbalanserarens **klientdel** ska distribueras till VM-instanser i en **serverdelspool**.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-135">The Azure Load Balancer uses information configured in **rules** and **health probes** to determine how new inbound traffic that is received on the Load Balancer's **frontend** is distributed to VM instances in a **backend pool**.</span></span>

### <a name="frontend"></a><span data-ttu-id="c3bb1-136">Klientdel</span><span class="sxs-lookup"><span data-stu-id="c3bb1-136">Frontend</span></span>

<span data-ttu-id="c3bb1-137">Lastbalanserarens klientdel är en IP-konfiguration som innehåller en eller flera offentliga IP-adresser som ger åtkomst till lastbalanseraren och dess program via Internet.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-137">The load balancer frontend is an IP configuration, containing one or more public IP addresses, that enables access to the load balancer and its applications over the Internet.</span></span>

### <a name="backend-address-pool"></a><span data-ttu-id="c3bb1-138">Serverdelsadresspool</span><span class="sxs-lookup"><span data-stu-id="c3bb1-138">Backend address pool</span></span>

<span data-ttu-id="c3bb1-139">Virtuella datorer ansluter till en lastbalanserare med ett virtuellt nätverkskort (vNIC).</span><span class="sxs-lookup"><span data-stu-id="c3bb1-139">Virtual machines connect to a load balancer using their virtual network interface card (vNIC).</span></span> <span data-ttu-id="c3bb1-140">Serverdelsadresspoolen innehåller IP-adresserna för de virtuella nätverkskort som är anslutna till lastbalanseraren.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-140">The back-end address pool contains the IP addresses of the vNICs that are connected to the load balancer.</span></span> <span data-ttu-id="c3bb1-141">Om du placerar alla dina virtuella datorer i en tillgänglighetsuppsättning kan du använda detta för att enkelt lägga till de virtuella datorerna i en serverdelspool när du konfigurerar lastbalanseraren.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-141">If you place all your VMs in an availability set, you can use this to easily add your VMs to a backend pool when configuring the load balancer.</span></span>

### <a name="health-probe"></a><span data-ttu-id="c3bb1-142">Hälsoavsökning</span><span class="sxs-lookup"><span data-stu-id="c3bb1-142">Health probe</span></span>

<span data-ttu-id="c3bb1-143">Lastbalanserare använder _hälsoavsökningar_ för att avgöra vilka virtuella datorer som kan bearbeta begäranden.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-143">Load balancers use _health probes_ to determine which virtual machines can service requests.</span></span> <span data-ttu-id="c3bb1-144">Lastbalanseraren distribuerar endast trafik till virtuella datorer som är tillgängliga och i drift.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-144">The load balancer will only distribute traffic to VMs that are available and operational.</span></span> 

<span data-ttu-id="c3bb1-145">En hälsoavsökning övervakar specifika portar på varje virtuell dator.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-145">A health probe monitors specific ports on each VM.</span></span> <span data-ttu-id="c3bb1-146">Du kan definiera vilken typ av svar som motsvarar ”hälsa”. Du kan till exempel kräva ett `HTTP 200 Available`-svar från ett webbprogram.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-146">You can define what type of response corresponds to "health"; for example, you might require an `HTTP 200 Available` response from a web application.</span></span> <span data-ttu-id="c3bb1-147">Som standard markeras en virtuell dator som ”ej tillgänglig” efter två fel i rad med intervall om 15 sekunder.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-147">By default, a VM will be marked as "unavailable" after two consecutive failures at 15-second intervals.</span></span>

### <a name="load-balancer-rules"></a><span data-ttu-id="c3bb1-148">Regler för lastbalanserare</span><span class="sxs-lookup"><span data-stu-id="c3bb1-148">Load balancer rules</span></span>

<span data-ttu-id="c3bb1-149">_Regler_ för lastbalanserare definierar hur trafik ska distribueras till de virtuella serverdelsdatorerna.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-149">Load balancer _rules_ define how traffic is distributed to backend VMs.</span></span> <span data-ttu-id="c3bb1-150">Målet är att distribuera begäranden på ett jämnt sätt över de felfria virtuella datorerna i serverdelspoolen.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-150">The goal is to distribute request fairly across the healthy VMs in the backend pool.</span></span>

<span data-ttu-id="c3bb1-151">Azure Load Balancer använder en hash-baserad algoritm för att skriva om huvudena i inkommande paket.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-151">The Azure Load Balancer uses a hash-based algorithm to rewrite the headers of inbound packets.</span></span> <span data-ttu-id="c3bb1-152">Som standard skapar lastbalanseraren en hash från:</span><span class="sxs-lookup"><span data-stu-id="c3bb1-152">By default, the Load Balancer creates a hash from:</span></span>

- <span data-ttu-id="c3bb1-153">källans IP-adress</span><span class="sxs-lookup"><span data-stu-id="c3bb1-153">source IP address</span></span>
- <span data-ttu-id="c3bb1-154">källporten</span><span class="sxs-lookup"><span data-stu-id="c3bb1-154">source port</span></span>
- <span data-ttu-id="c3bb1-155">mål-IP-adressen</span><span class="sxs-lookup"><span data-stu-id="c3bb1-155">destination IP address</span></span>
- <span data-ttu-id="c3bb1-156">målporten</span><span class="sxs-lookup"><span data-stu-id="c3bb1-156">destination port</span></span>
- <span data-ttu-id="c3bb1-157">IP-protokollnumret</span><span class="sxs-lookup"><span data-stu-id="c3bb1-157">IP protocol number</span></span>

<span data-ttu-id="c3bb1-158">Den här mekanismen säkerställer att alla paket i ett paketklientflöde skickas till samma VM-serverdelsinstans.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-158">This mechanism ensures that all packets within a packet client flow are sent to the same backend VM instance.</span></span> <span data-ttu-id="c3bb1-159">Ett nytt flöde från en klient använder en annan slumpmässigt allokerad källport. Därför ändras hashen, och lastbalanseraren kan skicka detta flöde till en annan serverdelsslutpunkt.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-159">A new flow from a client will use a different randomly allocated source port, so the hash will change, and the load balancer may send this flow to a different backend endpoint.</span></span>

## <a name="basic-vs-standard-load-balancer-skus"></a><span data-ttu-id="c3bb1-160">Basic- kontra Standard-lastbalanser-SKU:er</span><span class="sxs-lookup"><span data-stu-id="c3bb1-160">Basic vs. Standard load balancer SKUs</span></span>

<span data-ttu-id="c3bb1-161">Det finns två typer av Azure-lastbalanserare: **Basic** och **Standard**.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-161">There are two types of Azure Load Balancers: **Basic** and **Standard**.</span></span> <span data-ttu-id="c3bb1-162">De skiljer sig åt vad gäller skala, funktioner och priser.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-162">They differ in scale, features, and pricing.</span></span> <span data-ttu-id="c3bb1-163">Exempel:</span><span class="sxs-lookup"><span data-stu-id="c3bb1-163">For example:</span></span>

- <span data-ttu-id="c3bb1-164">Standard stöder HTTPS, men det gör inte Basic</span><span class="sxs-lookup"><span data-stu-id="c3bb1-164">Standard supports HTTPS while Basic does not</span></span>
- <span data-ttu-id="c3bb1-165">Poolstorleken kan vara mycket högre i Standard</span><span class="sxs-lookup"><span data-stu-id="c3bb1-165">Pool size can be much larger in Standard</span></span>
- <span data-ttu-id="c3bb1-166">Basic är kostnadsfri medan Standard debiteras baserat på regler och dataflöde.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-166">Basic is no-cost while Standard is charged based on rules and throughput.</span></span>

<span data-ttu-id="c3bb1-167">Standard är en överordnad uppsättning av Basic, så alla scenarier som är lämpliga för Basic bör även fungera med Standard.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-167">Standard is a superset of Basic, so any scenario suitable for Basic should also work on Standard.</span></span> <span data-ttu-id="c3bb1-168">Basic-SKU:n är generellt avsedd för prototyper och testning medan Standard rekommenderas för produktion.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-168">The Basic SKU is generally intended for prototyping and testing while Standard is recommended for production.</span></span>

## <a name="start-the-deployment-of-a-basic-public-load-balancer"></a><span data-ttu-id="c3bb1-169">Starta distributionen av en offentlig Basic-lastbalanserare</span><span class="sxs-lookup"><span data-stu-id="c3bb1-169">Start the deployment of a Basic Public Load Balancer</span></span>

<span data-ttu-id="c3bb1-170">För att skapa ett belastningsutjämnat VM-system behöver du skapa själva lastbalanseraren, skapa ett virtuellt nätverk som ska innehålla dina virtuella datorer och sedan lägga till de virtuella datorerna till det virtuella nätverket.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-170">To create a load-balanced VM system, you need to create the load balancer itself, create a virtual network to contain your virtual machines, and then add VMs to the virtual network.</span></span>

<span data-ttu-id="c3bb1-171">För att skapa lastbalanseraren med hjälp av Azure-portalen definierar du:</span><span class="sxs-lookup"><span data-stu-id="c3bb1-171">To create the load balancer using the Azure portal, you define:</span></span>

- <span data-ttu-id="c3bb1-172">Lastbalanserarens namn</span><span class="sxs-lookup"><span data-stu-id="c3bb1-172">Load balancer name</span></span>
- <span data-ttu-id="c3bb1-173">Typ: offentlig eller intern</span><span class="sxs-lookup"><span data-stu-id="c3bb1-173">Type: Public or Internal</span></span>
- <span data-ttu-id="c3bb1-174">SKU: Basic eller Standard</span><span class="sxs-lookup"><span data-stu-id="c3bb1-174">SKU: Basic or Standard</span></span>
- <span data-ttu-id="c3bb1-175">Offentlig IP-adress: dynamisk eller statisk</span><span class="sxs-lookup"><span data-stu-id="c3bb1-175">Public IP address: Dynamic or Static</span></span>
- <span data-ttu-id="c3bb1-176">Resursgrupp och plats</span><span class="sxs-lookup"><span data-stu-id="c3bb1-176">Resource group and Location</span></span>

<span data-ttu-id="c3bb1-177">De virtuella serverdelsdatorerna kommer alla att vara anslutna till samma virtuella nätverk (vNET), så nästa steg är att konfigurera den här resursen:</span><span class="sxs-lookup"><span data-stu-id="c3bb1-177">Your backend VMs will all be connected to the same virtual network (vNET), so you next need to configure this resource:</span></span>

- <span data-ttu-id="c3bb1-178">Namn på vNET</span><span class="sxs-lookup"><span data-stu-id="c3bb1-178">vNET name</span></span>
- <span data-ttu-id="c3bb1-179">Det adressutrymme som ska användas, till exempel 172.20.0.0/16</span><span class="sxs-lookup"><span data-stu-id="c3bb1-179">Address space to use, such as 172.20.0.0/16</span></span>
- <span data-ttu-id="c3bb1-180">Resursgrupp</span><span class="sxs-lookup"><span data-stu-id="c3bb1-180">Resource group</span></span>
- <span data-ttu-id="c3bb1-181">Namn för det undernät som ska användas</span><span class="sxs-lookup"><span data-stu-id="c3bb1-181">Name for the subnet to use</span></span>
- <span data-ttu-id="c3bb1-182">Adressutrymmet för undernätet (måste vara inom huvudutrymmet), till exempel 172.20.0.0/24</span><span class="sxs-lookup"><span data-stu-id="c3bb1-182">Address space for the subnet (must be within the main space), such as 172.20.0.0/24</span></span>

<span data-ttu-id="c3bb1-183">Sedan behöver du skapa och distribuera dina virtuella serverdelsdatorer och konfigurera dem att till använda ditt virtuella nätverk.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-183">You then need to create and deploy your backend VMs and configure them to use your vNET.</span></span> <span data-ttu-id="c3bb1-184">Du bör även placera dina virtuella datorer i samma tillgänglighetsuppsättning.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-184">You should also place your VMs into the same availability set.</span></span> <span data-ttu-id="c3bb1-185">Tillgänglighetsuppsättningar definierar nivån av feltolerans för en grupp med virtuella datorer, men för belastningsutjämning hjälper de dig även att tilldela dina virtuella datorer till serverdelspooler.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-185">Availability sets define the level of fault tolerance across a group of VMs, but for load balancing, they also help you assign your VMs to backend pools.</span></span>

<span data-ttu-id="c3bb1-186">Du har nu sett hur du använder en Azure Load Balancer som en del av en lösning för hög tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-186">You have now seen how to use an Azure Load Balancer as part of a high-availability solution.</span></span> <span data-ttu-id="c3bb1-187">Härnäst använder du dessa steg för att distribuera din egen lastbalanserare.</span><span class="sxs-lookup"><span data-stu-id="c3bb1-187">Next, you will use these steps to deploy your own load balancer.</span></span>