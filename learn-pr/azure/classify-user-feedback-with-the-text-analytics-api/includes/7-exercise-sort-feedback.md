<span data-ttu-id="6540b-101">Varje funktion måste ha en enda utlösarbindning.</span><span class="sxs-lookup"><span data-stu-id="6540b-101">Every function must have one, and only one, trigger binding.</span></span> <span data-ttu-id="6540b-102">Den definierar hur vår kod utlöses för körning.</span><span class="sxs-lookup"><span data-stu-id="6540b-102">It defines how our code is triggered to run.</span></span> <span data-ttu-id="6540b-103">Förutom en utlösare kan vi definiera bindningar som ansluter oss till datakällor.</span><span class="sxs-lookup"><span data-stu-id="6540b-103">In addition to a trigger, we can define bindings that connect us to data sources.</span></span> <span data-ttu-id="6540b-104">Om du minns från vårt diagram över lösningen vill vi skicka meddelanden till tre köer.</span><span class="sxs-lookup"><span data-stu-id="6540b-104">If you remember from our diagram of the solution, we want to send messages to three queues.</span></span> <span data-ttu-id="6540b-105">Så vi ska definiera anslutningarna som utdatabindningar i vår funktion.</span><span class="sxs-lookup"><span data-stu-id="6540b-105">So, we'll define those connections as output bindings in our function.</span></span> <span data-ttu-id="6540b-106">Vi skulle kunna skapa bindningarna via användargränssnittet för **utdatabindning**.</span><span class="sxs-lookup"><span data-stu-id="6540b-106">We could create those bindings through the **Output binding** UI.</span></span> <span data-ttu-id="6540b-107">Men för att spara tid ska vi redigera konfigurationsfilen direkt.</span><span class="sxs-lookup"><span data-stu-id="6540b-107">However, to save time, we'll edit the config file directly.</span></span>

1. <span data-ttu-id="6540b-108">Välj vår funktion, [!INCLUDE [func-name-discover](./func-name-discover.md)], i funktionappsportalen.</span><span class="sxs-lookup"><span data-stu-id="6540b-108">Select our function, [!INCLUDE [func-name-discover](./func-name-discover.md)], in the Function Apps portal.</span></span>

1. <span data-ttu-id="6540b-109">Utöka menyn **Visa filer** till höger på skärmen.</span><span class="sxs-lookup"><span data-stu-id="6540b-109">Expand the **View files** menu on the right of the screen.</span></span>

1. <span data-ttu-id="6540b-110">Under fliken **Visa filer** väljer du **function.json** för att öppna konfigurationsfilen i redigeraren.</span><span class="sxs-lookup"><span data-stu-id="6540b-110">Under the **View files** tab, select **function.json** to open the config file in the editor.</span></span>

1. <span data-ttu-id="6540b-111">Ersätt hela innehållet i konfigurationsfilen med följande JSON.</span><span class="sxs-lookup"><span data-stu-id="6540b-111">Replace the entire content of the config file with the following JSON.</span></span> 

[!code-json[](../code/function.json)]

<span data-ttu-id="6540b-112">Vi har lagt till tre nya bindningar till konfigurationsfilen.</span><span class="sxs-lookup"><span data-stu-id="6540b-112">We've added three new bindings to the config.</span></span>

- <span data-ttu-id="6540b-113">Varje ny bindning är av typen `queue`.</span><span class="sxs-lookup"><span data-stu-id="6540b-113">Each new binding is of type `queue`.</span></span> <span data-ttu-id="6540b-114">De här bindningarna är för de tre köerna som vi ska fylla i våra feedbackmeddelanden till när vi vet feedbackens sentiment.</span><span class="sxs-lookup"><span data-stu-id="6540b-114">These bindings are for the three queues that we'll populate with our feedback messages to once we know the sentiment of the feedback.</span></span>
- <span data-ttu-id="6540b-115">Varje bindning har en riktning som definieras som `out`, eftersom vi ska publicera meddelanden till dessa köer.</span><span class="sxs-lookup"><span data-stu-id="6540b-115">Each binding has a direction defined as `out`, since we'll post messages to these queues.</span></span>
- <span data-ttu-id="6540b-116">Varje bindning använder samma anslutning till vårt lagringskonto.</span><span class="sxs-lookup"><span data-stu-id="6540b-116">Each binding uses the same connection to our storage account.</span></span>
- <span data-ttu-id="6540b-117">Varje bindning har en unik `queueName` och `name`.</span><span class="sxs-lookup"><span data-stu-id="6540b-117">Each binding has a unique `queueName` and `name`.</span></span>

<span data-ttu-id="6540b-118">Att publicera ett meddelande till kön är lika enkelt som, vi säger `context.bindings.negativeFeedbackQueueItem = "<message>"`.</span><span class="sxs-lookup"><span data-stu-id="6540b-118">Posting a message to a queue is as easy as saying, for example,  `context.bindings.negativeFeedbackQueueItem = "<message>"`.</span></span>

## <a name="update-implementation-to-sort-feedback-into-queues-based-on-sentiment-score"></a><span data-ttu-id="6540b-119">Uppdatera implementering för sortera feedback i köer baserat på sentimentpoäng</span><span class="sxs-lookup"><span data-stu-id="6540b-119">Update implementation to sort feedback into queues based on sentiment score</span></span>

<span data-ttu-id="6540b-120">Målet med vår feedbacksortering är att sortera feedback i tre buckets, positiv, neutral och negativ.</span><span class="sxs-lookup"><span data-stu-id="6540b-120">The goal of our feedback sorter is to sort feedback into three buckets, positive, neutral, and negative.</span></span> <span data-ttu-id="6540b-121">Hittills har vi vår indatakö, vår kod för att anropa API för textanalys och vi har definierat våra utdataköer.</span><span class="sxs-lookup"><span data-stu-id="6540b-121">So far, we have our input queue, our code to call Text Analytics API, and we've defined our output queues.</span></span> <span data-ttu-id="6540b-122">I den här delen har vi lagt till logiken för att flytta meddelanden till köerna baserat på sentiment.</span><span class="sxs-lookup"><span data-stu-id="6540b-122">In this section, we'll add the logic to move messages into those queues based on sentiment.</span></span>

1. <span data-ttu-id="6540b-123">Gå till vår funktion, [!INCLUDE [func-name-discover](./func-name-discover.md)], och öppna `index.js` i kodredigeraren igen.</span><span class="sxs-lookup"><span data-stu-id="6540b-123">Navigate to our function, [!INCLUDE [func-name-discover](./func-name-discover.md)], and  open `index.js` in the code editor again.</span></span>

1. <span data-ttu-id="6540b-124">Ersätt implementeringen med följande uppdatering.</span><span class="sxs-lookup"><span data-stu-id="6540b-124">Replace the implementation with the following update.</span></span>
[!code-javascript[](../code/discover-sentiment+sort.js?highlight=25-48)]

<span data-ttu-id="6540b-125">Vi har lagt till den markerade koden i vår implementering.</span><span class="sxs-lookup"><span data-stu-id="6540b-125">We've added the highlighted code to our implementation.</span></span> <span data-ttu-id="6540b-126">Koden parsar svaret från den kognitiva tjänsten API för textanalys.</span><span class="sxs-lookup"><span data-stu-id="6540b-126">The code parses the response from the Text Analytics API cognitive service.</span></span> <span data-ttu-id="6540b-127">Baserat på sentimentpoängen vidarebefordras meddelandet till en av de tre utdataköerna.</span><span class="sxs-lookup"><span data-stu-id="6540b-127">Based on the sentiment score, the message is forwarded to one of or three output queues.</span></span> <span data-ttu-id="6540b-128">Koden för att publicera meddelandet är bara att ange rätt bindningsparameter.</span><span class="sxs-lookup"><span data-stu-id="6540b-128">The code to post the message is just setting the correct binding parameter.</span></span>

## <a name="try-it-out"></a><span data-ttu-id="6540b-129">Prova</span><span class="sxs-lookup"><span data-stu-id="6540b-129">Try it out</span></span>

<span data-ttu-id="6540b-130">För att testa den uppdaterade implementeringen går vi tillbaka till Storage Explorer.</span><span class="sxs-lookup"><span data-stu-id="6540b-130">To test the updated implementation, we'll head back to the Storage Explorer.</span></span> 

1. <span data-ttu-id="6540b-131">Gå till din resursgrupp i delen **Resursgrupper** i portalen.</span><span class="sxs-lookup"><span data-stu-id="6540b-131">Navigate to your resource group in the **Resource Groups** section of the portal.</span></span>

1. <span data-ttu-id="6540b-132">Välj resursgruppen som används i den här lektionen.</span><span class="sxs-lookup"><span data-stu-id="6540b-132">Select the resource group used in this lesson.</span></span>

1. <span data-ttu-id="6540b-133">I panelen **Resursgrupp** som öppnas letar du reda på lagringskontot och markerar det.</span><span class="sxs-lookup"><span data-stu-id="6540b-133">In the **Resource group** panel that opens, locate the Storage Account entry and select it.</span></span>
<span data-ttu-id="6540b-134">![Skärmbild av valt lagringskonto i fönstret Resursgrupp.](../media-draft/select-storage-account.png)</span><span class="sxs-lookup"><span data-stu-id="6540b-134">![Screenshot storage account selected in the Resource Group window.](../media-draft/select-storage-account.png)</span></span>

1. <span data-ttu-id="6540b-135">Välj **Storage Explorer (förhandsversion)** på den västra menyn i lagringskontots huvudfönster.</span><span class="sxs-lookup"><span data-stu-id="6540b-135">Select **Storage Explorer (preview)** from the left menu of the Storage Account main window.</span></span>  <span data-ttu-id="6540b-136">Den här åtgärden öppnar Azure Storage Explorer i portalen.</span><span class="sxs-lookup"><span data-stu-id="6540b-136">This action opens the Azure Storage Explorer inside the portal.</span></span> <span data-ttu-id="6540b-137">Skärmen bör likna följande skärmbild i det här stadiet.</span><span class="sxs-lookup"><span data-stu-id="6540b-137">Your screen should look like the following screenshot at this stage.</span></span>
<span data-ttu-id="6540b-138">![Skärmbild av Storage Explorer som visar vårt lagringskonto med en kö.](../media-draft/storage-explorer-menu-inputq.png)</span><span class="sxs-lookup"><span data-stu-id="6540b-138">![Screenshot of storage explorer showing our storage account, with one queue currently.](../media-draft/storage-explorer-menu-inputq.png)</span></span>

<span data-ttu-id="6540b-139">Det finns en listad kö under samlingen **Köer**.</span><span class="sxs-lookup"><span data-stu-id="6540b-139">We have one queue listed under the **Queues** collection.</span></span> <span data-ttu-id="6540b-140">Kön är [!INCLUDE [input-q](./q-name-input.md)], indatakön vi definierade i det föregående testavsnittet i modulen.</span><span class="sxs-lookup"><span data-stu-id="6540b-140">This queue is [!INCLUDE [input-q](./q-name-input.md)],  the input queue we defined in the preceding test section of the module.</span></span>

1. <span data-ttu-id="6540b-141">Välj [!INCLUDE [input-q](./q-name-input.md)] på menyn till höger så ser du Datautforskaren för den här kön.</span><span class="sxs-lookup"><span data-stu-id="6540b-141">Select [!INCLUDE [input-q](./q-name-input.md)] in the left-hand menu to see the data explorer for this queue.</span></span> <span data-ttu-id="6540b-142">Som förväntat fanns det inga data i kön.</span><span class="sxs-lookup"><span data-stu-id="6540b-142">As expected, the queue had no data.</span></span> <span data-ttu-id="6540b-143">Vi lägger till ett meddelande till kön med kommandot **Lägg till meddelande** överst i fönstret.</span><span class="sxs-lookup"><span data-stu-id="6540b-143">Let's add a message to the queue using the **Add Message** command at the top of the window.</span></span> 

1. <span data-ttu-id="6540b-144">I dialogrutan **Lägg till meddelande** skriver du ”Jag har kul med den här övningen!”</span><span class="sxs-lookup"><span data-stu-id="6540b-144">In the **Add Message** dialog, enter "I'm having fun with this exercise!"</span></span> <span data-ttu-id="6540b-145">i **meddelandetextfältet** och klickar på **OK** längst ned i dialogrutan.</span><span class="sxs-lookup"><span data-stu-id="6540b-145">into the **Message text** field and click **OK** at the bottom of the dialog.</span></span> 

1. <span data-ttu-id="6540b-146">Meddelandet visas i datafönstret för [!INCLUDE [input-q](./q-name-input.md)].</span><span class="sxs-lookup"><span data-stu-id="6540b-146">The message is displayed in the data window for [!INCLUDE [input-q](./q-name-input.md)].</span></span> <span data-ttu-id="6540b-147">Efter några sekunder klickar du på **Uppdatera** överst i datavyn för att uppdatera vyn av kön.</span><span class="sxs-lookup"><span data-stu-id="6540b-147">After a few seconds, click **Refresh** at the top of the data view to refresh the view of the queue.</span></span> <span data-ttu-id="6540b-148">Lägg märke till att meddelandet försvinner efter en stund.</span><span class="sxs-lookup"><span data-stu-id="6540b-148">Observe that the message disappears after a while.</span></span> <span data-ttu-id="6540b-149">Men vart tog det vägen?</span><span class="sxs-lookup"><span data-stu-id="6540b-149">So, where did it go?</span></span>

1. <span data-ttu-id="6540b-150">Högerklicka på samlingen **KÖER** på menyn till vänster.</span><span class="sxs-lookup"><span data-stu-id="6540b-150">Right-click on the **QUEUES** collection in the left-hand menu.</span></span> <span data-ttu-id="6540b-151">Observera ett en *ny* kö visas.</span><span class="sxs-lookup"><span data-stu-id="6540b-151">Observe that a *new* queue has appeared.</span></span>
<span data-ttu-id="6540b-152">![Skärmbild av Storage Explorer som visar att en ny kö har skapats i samlingen.</span><span class="sxs-lookup"><span data-stu-id="6540b-152">![Screenshot of Storage Explorer with showing a new queue has been created in the collection.</span></span> <span data-ttu-id="6540b-153">Kön har ett meddelande.](../media-draft/sa-new-output-q.png)</span><span class="sxs-lookup"><span data-stu-id="6540b-153">The queue has one message.](../media-draft/sa-new-output-q.png)</span></span>

<span data-ttu-id="6540b-154">Kön [!INCLUDE [positive-q](./q-name-positive.md)] skapades automatiskt när ett meddelande publicerades till den för första gången.</span><span class="sxs-lookup"><span data-stu-id="6540b-154">The queue [!INCLUDE [positive-q](./q-name-positive.md)] was automatically created when a message was posted to it for the first time.</span></span> <span data-ttu-id="6540b-155">Med Azure Functions-köutdatabindningar måste du inte manuellt skapa utdatakön innan du publicerar till den!</span><span class="sxs-lookup"><span data-stu-id="6540b-155">With Azure Functions queue output bindings, you don't have to manually create the output queue before posting to it!</span></span> <span data-ttu-id="6540b-156">Nu när vi ser att ett inkommande meddelande har sorterats av funktionen till [!INCLUDE [positive-q](./q-name-positive.md)] ska vi se var följande meddelande hamnar.</span><span class="sxs-lookup"><span data-stu-id="6540b-156">Now that we see an incoming message has been sorted by our function into [!INCLUDE [positive-q](./q-name-positive.md)], let's see where the following messages land.</span></span>

5. <span data-ttu-id="6540b-157">Med samma steg som ovan ska du lägga till följande meddelanden i [!INCLUDE [input-q](./q-name-input.md)].</span><span class="sxs-lookup"><span data-stu-id="6540b-157">Using the same steps as above, add the following messages to [!INCLUDE [input-q](./q-name-input.md)].</span></span>

- <span data-ttu-id="6540b-158">”Jag gillar broccoli!”</span><span class="sxs-lookup"><span data-stu-id="6540b-158">"I like broccoli!"</span></span>
- <span data-ttu-id="6540b-159">”Microsoft är ett företag”</span><span class="sxs-lookup"><span data-stu-id="6540b-159">"Microsoft is a company"</span></span>

6. <span data-ttu-id="6540b-160">Klicka på **Uppgradera** tills [!INCLUDE [input-q](./q-name-input.md)] är tom igen.</span><span class="sxs-lookup"><span data-stu-id="6540b-160">Click **Refresh** until [!INCLUDE [input-q](./q-name-input.md)] is empty once again.</span></span> <span data-ttu-id="6540b-161">Den här processen kan ta en stund och kräver flera uppdateringar.</span><span class="sxs-lookup"><span data-stu-id="6540b-161">This process might take a few moments and require several refreshes.</span></span>

1. <span data-ttu-id="6540b-162">Högerklicka på samlingen **KÖER** och lägg märke till att två köer till visas.</span><span class="sxs-lookup"><span data-stu-id="6540b-162">Right-click on the **QUEUES** collection and observe two more queues appearing.</span></span> <span data-ttu-id="6540b-163">Köerna heter [!INCLUDE [neutral-q](./q-name-neutral.md)] och [!INCLUDE [negative-q](./q-name-negative.md)].</span><span class="sxs-lookup"><span data-stu-id="6540b-163">The queues are named [!INCLUDE [neutral-q](./q-name-neutral.md)] and [!INCLUDE [negative-q](./q-name-negative.md)].</span></span> <span data-ttu-id="6540b-164">Det kan ta några sekunder, så fortsätt att uppdatera samlingen **KÖER** till du ser de nya köerna.</span><span class="sxs-lookup"><span data-stu-id="6540b-164">This might take a few seconds, so continue refreshing the **QUEUES** collection until new queues.</span></span> <span data-ttu-id="6540b-165">Din kölista bör se ut ungefär så här när du är klar.</span><span class="sxs-lookup"><span data-stu-id="6540b-165">When complete, your queue list should look like the following.</span></span>

![Skärmbild av Storage Explorer som visar fyra köer i samlingen KÖER.](../media-draft/sa-final-q-list.png)

<span data-ttu-id="6540b-167">Klicka på varje kö i listan för att se om de har meddelanden.</span><span class="sxs-lookup"><span data-stu-id="6540b-167">Click on each queue in the list to see whether they have messages.</span></span> <span data-ttu-id="6540b-168">Om du har lagt till de föreslagna meddelandena bör du se ett meddelande i [!INCLUDE [positive-q](./q-name-positive.md)], [!INCLUDE [neutral-q](./q-name-neutral.md)] och [!INCLUDE [negative-q](./q-name-negative.md)].</span><span class="sxs-lookup"><span data-stu-id="6540b-168">If you added the suggested messages, you should see one message in [!INCLUDE [positive-q](./q-name-positive.md)], [!INCLUDE [neutral-q](./q-name-neutral.md)], and [!INCLUDE [negative-q](./q-name-negative.md)].</span></span>

<span data-ttu-id="6540b-169">Grattis!</span><span class="sxs-lookup"><span data-stu-id="6540b-169">Congratulations!</span></span> <span data-ttu-id="6540b-170">Nu har vi en fungerande feedbacksortering!</span><span class="sxs-lookup"><span data-stu-id="6540b-170">We now have a working feedback sorter!</span></span> <span data-ttu-id="6540b-171">När meddelanden hamnar i indatakön använder vår funktion tjänsten API för textanalys för att hämta en sentimentpoäng.</span><span class="sxs-lookup"><span data-stu-id="6540b-171">As messages arrive in the input queue, our function uses the Text Analytics API service to get a sentiment score.</span></span> <span data-ttu-id="6540b-172">Baserat på den poängen vidarebefordrar funktionen meddelandena till rätt kö.</span><span class="sxs-lookup"><span data-stu-id="6540b-172">Based on that score, the function forwards the messages to the appropriate queue.</span></span> <span data-ttu-id="6540b-173">Även om det verkar som funktionen endast bearbetar ett köobjekt i taget läser Azure Functions-körmiljön faktiskt batchar med köobjekt och startar andra instanser av funktionen för att bearbeta dem parallellt.</span><span class="sxs-lookup"><span data-stu-id="6540b-173">While it seems like the function processes only one queue item at a time, the Azure Functions runtime will actually read batches of queue items and spin up other instances of our function to process them in parallel.</span></span> 