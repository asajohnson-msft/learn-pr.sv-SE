<span data-ttu-id="0c0d3-101">Den vanligaste säkerhetsbristen i program i dag är att inte korrekt bearbeta indata som tas emot från externa källor, särskilt _användarinmatning_.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-101">The most prevalent security weakness of applications today is to not correctly process input received from external sources, particularly _user input_.</span></span> <span data-ttu-id="0c0d3-102">Du bör alltid kontrollera indata noggrant för att se till att de verifieras innan de används.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-102">You should always take a close look at any input to make sure it has been validated before it is used.</span></span> <span data-ttu-id="0c0d3-103">Om du inte gör detta kan det leda till förlust eller exponering av data, eskalering av privilegier eller till och med körning av skadlig kod på andra användares datorer!</span><span class="sxs-lookup"><span data-stu-id="0c0d3-103">Failing to do this can result in data loss or exposure, escalation of privilege, or even execution of malicious code on other users' computers!</span></span>

<span data-ttu-id="0c0d3-104">Det som är så onödigt med dessa problem att de enkelt kan lösas.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-104">The tragic thing is that this is an easy problem to solve.</span></span> <span data-ttu-id="0c0d3-105">Här går vi igenom hur du behandlar data: när de tas emot, när de visas på skärmen och när de är sparas för senare användning.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-105">Here we will cover how to treat data; when it’s received, when it’s displayed on the screen, and when it's stored for later use.</span></span>

## <a name="why-do-we-need-to-validate-our-input"></a><span data-ttu-id="0c0d3-106">Varför behöver vi verifiera våra indata?</span><span class="sxs-lookup"><span data-stu-id="0c0d3-106">Why do we need to validate our input?</span></span>

<span data-ttu-id="0c0d3-107">Anta att du skapar ett gränssnitt för att användare ska kunna skapa ett konto på din webbplats.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-107">Imagine that you are building an interface to allow a user to create an account on your website.</span></span> <span data-ttu-id="0c0d3-108">Våra profildata inkluderar ett namn, en e-postadress och ett smeknamn som vi visar för alla som besöker webbplatsen.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-108">Our profile data includes a name, email, and a nickname that we will display to everyone who visits the site.</span></span> <span data-ttu-id="0c0d3-109">Vad händer om en ny användare skapar en profil och anger ett smeknamn som innehåller vissa SQL-kommandon?</span><span class="sxs-lookup"><span data-stu-id="0c0d3-109">What if a new user creates a profile and enters a nickname that includes some SQL commands?</span></span> <span data-ttu-id="0c0d3-110">Vad händer om våra illasinnade användare anger något i still med följande:</span><span class="sxs-lookup"><span data-stu-id="0c0d3-110">For example - what if our bad user enters something like:</span></span>

```output
Eve'); DROP TABLE Users;--
```

<span data-ttu-id="0c0d3-111">Om vi utan vidare infogar det här värdet i en databas kan det potentiellt ändra SQL-instruktionen till att köra kommandon som vi absolut inte vill!</span><span class="sxs-lookup"><span data-stu-id="0c0d3-111">If we just blindly insert this value into a database, it could potentially alter the SQL statement to execute commands we absolutely don't want to run!</span></span> <span data-ttu-id="0c0d3-112">Det här kallas en ”SQL-inmatningsattack” och är en av de _många_ typer av kryphål som potentiellt kan utföras när indata inte hanteras på rätt sätt.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-112">This is referred to as a "SQL Injection" attack and is one of the _many_ types of exploits that can potentially be done when you don't properly handle inputs.</span></span> <span data-ttu-id="0c0d3-113">Vad kan vi då göra för att åtgärda detta?</span><span class="sxs-lookup"><span data-stu-id="0c0d3-113">So, what can we do to fix this?</span></span> <span data-ttu-id="0c0d3-114">I den här enheten får du lära dig när indata ska saneras, hur utdata ska kodas samt hur du skapar parametriserade frågor (vilket löser kryphålet ovan!).</span><span class="sxs-lookup"><span data-stu-id="0c0d3-114">This unit will teach you when to sanitize input, how to encode output, and how to create parameterized queries (which solves the above exploit!).</span></span> <span data-ttu-id="0c0d3-115">Det här är de tre huvudsakliga försvarsteknikerna mot skadliga indata som försöker inmatas i dina program.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-115">These are the three main defense techniques against malicious input being entered into your applications.</span></span>

## <a name="when-do-i-need-to-validate-input"></a><span data-ttu-id="0c0d3-116">När behöver jag verifiera indata?</span><span class="sxs-lookup"><span data-stu-id="0c0d3-116">When do I need to validate input?</span></span>

<span data-ttu-id="0c0d3-117">Svaret är _alltid_.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-117">The answer is _always_.</span></span> <span data-ttu-id="0c0d3-118">Du måste verifiera **alla** indata till ditt program.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-118">You must validate **every** input for your application.</span></span> <span data-ttu-id="0c0d3-119">Detta inkluderar parametrar i URL:en, indata från användare, data från databasen, data från ett API och allt som skickas i klartext som en användare potentiellt kan manipulera.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-119">This includes parameters in the URL, input from the user, data from the database, data from an API and anything that is passed in the clear that a user could potentially manipulate.</span></span> <span data-ttu-id="0c0d3-120">Använd alltid metoden med en vitlista, vilket innebär att du bara godkänner indata som är ”bekräftat goda” i stället för en svartlista (där du specifikt letar efter felaktiga indata) eftersom det är omöjligt att skapa en fullständig lista över potentiellt skadliga indata.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-120">Always use a whitelist approach, which means you only accept "known good" input, instead of a blacklist (where you specifically look for bad input) because it's impossible to think of a complete list of potentially dangerous input.</span></span>  <span data-ttu-id="0c0d3-121">Utför det här arbetet på serversidan, inte på klientsidan (eller utöver klientsidan) så att dina försvar inte kan kringgås.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-121">Do this work on the server, not the client-side (or in addition to the client-side), to ensure that your defenses cannot be circumvented.</span></span> <span data-ttu-id="0c0d3-122">Om du behandlar **ALLA** data som ej betrodda skyddar du mot de flesta vanliga säkerhetshoten för webbappar.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-122">Treat **ALL** data as untrusted and you will protect yourself from most of the common web app vulnerabilities.</span></span>

<span data-ttu-id="0c0d3-123">Om du använder ASP.NET ger ramverket [utmärkt stöd för att verifiera indata](https://docs.microsoft.com/aspnet/web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites) på både klient- och servernsidan.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-123">If you are using ASP.NET, the framework provides [great support for validating input](https://docs.microsoft.com/aspnet/web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites) on both the client and server side.</span></span>

<span data-ttu-id="0c0d3-124">Om du använder ett annat webbramverk finns det vissa bra metoder för att utföra verifiering av indata tillgängliga på [OWASP:s översiktsblad om verifiering av indata](https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet).</span><span class="sxs-lookup"><span data-stu-id="0c0d3-124">If you are using another web framework, there are some great techniques for doing input validation available on the [OWASP Input Validation Cheatsheet](https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet).</span></span>


## <a name="always-use-parameterized-queries"></a><span data-ttu-id="0c0d3-125">Använd alltid parametriserade frågor</span><span class="sxs-lookup"><span data-stu-id="0c0d3-125">Always use parameterized queries</span></span>

<span data-ttu-id="0c0d3-126">SQL-databaser används ofta för att lagra data. Till exempel kan vi lagra vår profilinformation i SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-126">SQL databases are commonly used to store data - we might be storing our profile information in SQL Server for example.</span></span>  <span data-ttu-id="0c0d3-127">Skapa aldrig infogat SQL eller andra databasfrågor ”i farten” i koden och skicka den direkt till databasen – som vi såg ovan kan resultatet bli katastrofalt.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-127">Never create inline SQL or other database queries "on the fly" in your code and send it directly to the database, this is a recipe for disaster, as we saw above.</span></span>

<span data-ttu-id="0c0d3-128">Till exempel ska du **inte göra detta** (kallas även infogat SQL):</span><span class="sxs-lookup"><span data-stu-id="0c0d3-128">For example, **do not do this** (known as inline SQL):</span></span>

```csharp
string userName = ... // receive input from the user BEWARE!
...
string query = "SELECT *  FROM  [dbo].[users] WHERE userName = '" + userName + "'";
```

<span data-ttu-id="0c0d3-129">Här sammanfogar vi textsträngar för att skapa frågan. Vi använder indata från användaren och genererar en dynamisk SQL-fråga för att leta upp användaren.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-129">Here we concatenate text strings together to create the query, taking the input from the user and generating a dynamic SQL query to lookup the user.</span></span> <span data-ttu-id="0c0d3-130">Om en illasinnad användare skulle inse att vi gör detta eller helt enkelt _prova_ olika indataformat för att se om det finns en sårbarhet kan det leda till en stor katastrof.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-130">Again, if an evil user realized we were doing this, or just _tried_ different input styles to see if there was a vulnerability, we could end up with a major disaster.</span></span> <span data-ttu-id="0c0d3-131">I stället bör vi använda parametriserade SQL-instruktioner eller ännu bättre – lagrade procedurer:</span><span class="sxs-lookup"><span data-stu-id="0c0d3-131">Instead, prefer to use parameterized SQL statements, or even better - stored procedures:</span></span>

```sql
-- Lookup a user
CREATE PROCEDURE sp_findUser
(
@UserName varchar(50)
)

SELECT *  FROM  [dbo].[users] WHERE userName = @UserName
```

<span data-ttu-id="0c0d3-132">Sedan kan du anropa proceduren från din kod på ett säkert sätt; du skickar strängen `userName` utan att behöva bekymra dig om den behandlas som en del av SQL-instruktionen.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-132">Then you can invoke the procedure from your code safely, passing it the `userName` string without worrying about it being treated as part of the SQL statement.</span></span>

## <a name="always-encode-your-output"></a><span data-ttu-id="0c0d3-133">Koda alltid dina utdata</span><span class="sxs-lookup"><span data-stu-id="0c0d3-133">Always encode your output</span></span>

<span data-ttu-id="0c0d3-134">Alla utdata som du presenterar visuellt eller i filer ska alltid kodas och undantas.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-134">Any output you present visually or in files should always be encoded and escaped.</span></span> <span data-ttu-id="0c0d3-135">Detta kan skydda dig om något förbises i saneringsomgången eller om koden av misstag genererar något som kan användas i skadligt syfte.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-135">This can protect you in case something was missed in the sanitization pass, or the code accidentally generates something that can be used maliciously.</span></span> <span data-ttu-id="0c0d3-136">På så sätt ser du till att allt visas som _utdata_ och inte oavsiktligt tolkas som något som ska köras.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-136">This will make sure that everything is displayed as _output_ and not inadvertently interpreted as something that should be executed.</span></span> <span data-ttu-id="0c0d3-137">Det här är en annan mycket vanlig angreppsmetod som kallas ”skriptkörning över flera webbplatser” (XSS, Cross-Site Scripting).</span><span class="sxs-lookup"><span data-stu-id="0c0d3-137">This is another very common attack technique referred to as "Cross-Site Scripting" (XSS).</span></span>

<span data-ttu-id="0c0d3-138">Eftersom det här är ett vanligt krav utgör det här ytterligare ett område där ASP.NET gör arbetet åt dig.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-138">Since this is such as common requirement, this is another areas where ASP.NET will do the work for you.</span></span> <span data-ttu-id="0c0d3-139">Som standard [är alla utdata redan kodade](https://docs.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-2.1).</span><span class="sxs-lookup"><span data-stu-id="0c0d3-139">By default, [all output is already encoded](https://docs.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-2.1).</span></span> <span data-ttu-id="0c0d3-140">Om du använder ett annat webbramverk kan du kontrollera dina alternativ för utdatakodning på webbplatser med [OWASP:s översiktsblad om XSS-skydd](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet).</span><span class="sxs-lookup"><span data-stu-id="0c0d3-140">If you are using another web framework, you can verify your options for output encoding on websites with the [OWASP XSS Prevention Cheatsheet](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet).</span></span>

## <a name="summary"></a><span data-ttu-id="0c0d3-141">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="0c0d3-141">Summary</span></span>

<span data-ttu-id="0c0d3-142">Att sanera och verifiera dina indata är ett nödvändigt krav för att se till att dina indata är giltiga och säkra att använda och lagra.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-142">Santizing and validating your input is a necessary requirement to ensure your input is valid and safe to use and store.</span></span> <span data-ttu-id="0c0d3-143">De flesta moderna webbramverk har inbyggda funktioner som kan automatisera en del av det här arbetet – läs dokumentationen för det ramverk du väljer och se vilka funktioner det erbjuder.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-143">Most modern web frameworks offer built-in features which can automate some of this work - make sure to check your preferred framework's documentation and see what features it offers.</span></span> <span data-ttu-id="0c0d3-144">Tänk även på att även om webbplatser är det vanligaste stället där detta inträffar så kan det förekomma liknande problem i andra typer av program. Även den där häftiga skrivbordsappen som du skriver kan drabbas!</span><span class="sxs-lookup"><span data-stu-id="0c0d3-144">Also, keep in mind that while the most common place this occurs is in web applications, other types of applications can have similar issues - so don't think you're safe if you are writing that cool desktop app!</span></span> <span data-ttu-id="0c0d3-145">Du behöver fortfarande kunna hantera indata från användare för att säkerställa att ingen använder din app för att skada dina data eller företagets rykte.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-145">You still need to properly handle user input to ensure someone doesn't use your app to corrupt your data, or damage your company's reputation.</span></span>


## <a name="knowledge-check"></a><span data-ttu-id="0c0d3-146">Kunskapskontroll</span><span class="sxs-lookup"><span data-stu-id="0c0d3-146">Knowledge Check</span></span>

<span data-ttu-id="0c0d3-147">Vilka av följande datakällor behöver saneras?</span><span class="sxs-lookup"><span data-stu-id="0c0d3-147">Which of the following data sources need to be sanitized?</span></span>
* <span data-ttu-id="0c0d3-148">Data från ett tredjeparts-API</span><span class="sxs-lookup"><span data-stu-id="0c0d3-148">Data from a 3rd party API</span></span>
* <span data-ttu-id="0c0d3-149">Data från URL-parametern</span><span class="sxs-lookup"><span data-stu-id="0c0d3-149">Data from the URL parameter</span></span>
* <span data-ttu-id="0c0d3-150">Data som samlas in från användaren via ett inmatningsfält</span><span class="sxs-lookup"><span data-stu-id="0c0d3-150">Data collected from the user via an input field</span></span>
* <span data-ttu-id="0c0d3-151">Alla ovanstående (rätt svar)</span><span class="sxs-lookup"><span data-stu-id="0c0d3-151">All the above (correct answer)</span></span>

<span data-ttu-id="0c0d3-152">Vilka av följande data behöver kodas för utdata?</span><span class="sxs-lookup"><span data-stu-id="0c0d3-152">Which of the following data needs to be output encoded?</span></span>
* <span data-ttu-id="0c0d3-153">Data som sparas i databasen</span><span class="sxs-lookup"><span data-stu-id="0c0d3-153">Data saved to the database</span></span>
* <span data-ttu-id="0c0d3-154">Datum som ska visas på skärmen (rätt svar)</span><span class="sxs-lookup"><span data-stu-id="0c0d3-154">Date to be output to the screen (correct answer)</span></span>
* <span data-ttu-id="0c0d3-155">Data som skickas till ett tredjeparts-API</span><span class="sxs-lookup"><span data-stu-id="0c0d3-155">Data sent to a 3rd party API</span></span>
* <span data-ttu-id="0c0d3-156">Data i URL-parametrarna</span><span class="sxs-lookup"><span data-stu-id="0c0d3-156">Data in the URL parameters</span></span>

<span data-ttu-id="0c0d3-157">Parametriserade frågor (lagrade procedurer i SQL) är alltid ett säkrare alternativ för att kommunicera med databasen eftersom:</span><span class="sxs-lookup"><span data-stu-id="0c0d3-157">Parameterized queries (stored procedures in SQL) are always a more secure choice for talking to the database because:</span></span>
* <span data-ttu-id="0c0d3-158">De är mer organiserad än infogade databaskommandon och därför mindre förvirrande för användaren.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-158">They are more organized than inline database commands, and therefore less confusing for users.</span></span>
* <span data-ttu-id="0c0d3-159">Det finns en tydlig beskrivning av skriptet i den lagrade proceduren, vilket ger bättre insyn.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-159">There is a clear outline of the script in the stored procedure, ensuring better visibility.</span></span>
* <span data-ttu-id="0c0d3-160">Hackare kan inte programmera i SQL.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-160">Hackers don’t understand how to program in SQL.</span></span>
* <span data-ttu-id="0c0d3-161">Parametriserade frågor ersätter variabler innan frågor körs, vilket förhindrar att koden skickas som en variabel.</span><span class="sxs-lookup"><span data-stu-id="0c0d3-161">Parameterized queries substitute variables before running queries, meaning it avoids the opportunity for code to be submitted in place of a variable.</span></span> <span data-ttu-id="0c0d3-162">(rätt svar)</span><span class="sxs-lookup"><span data-stu-id="0c0d3-162">(correct answer)</span></span>
