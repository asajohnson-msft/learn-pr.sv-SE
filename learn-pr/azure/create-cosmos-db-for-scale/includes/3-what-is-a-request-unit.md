<span data-ttu-id="460be-101">Nästa steg är att se över dataflödet i vår databas.</span><span class="sxs-lookup"><span data-stu-id="460be-101">Next we'll consider the data throughout for our database.</span></span> <span data-ttu-id="460be-102">Det här är viktigt så att vi säkert kan hantera den transaktionsvolym som krävs enligt våra affärsbehov.</span><span class="sxs-lookup"><span data-stu-id="460be-102">This is important to ensure we can handle the volume of transactions for our business needs.</span></span> <span data-ttu-id="460be-103">Dataflödesbehovet behöver inte vara statiskt.</span><span class="sxs-lookup"><span data-stu-id="460be-103">Throughput requirements aren't always consistent.</span></span> <span data-ttu-id="460be-104">Du kanske till exempel skapar en shoppingwebbplats som behöver skalas ut under reor eller storhelger.</span><span class="sxs-lookup"><span data-stu-id="460be-104">For example, you may be building a shopping website that needs to scale during sales or holidays.</span></span> <span data-ttu-id="460be-105">Vi börjar med att uppskatta dataflödesbehovet.</span><span class="sxs-lookup"><span data-stu-id="460be-105">We'll start estimating your database throughput requirements.</span></span>

## <a name="what-is-database-throughput"></a><span data-ttu-id="460be-106">Vad är dataflöden i databaser?</span><span class="sxs-lookup"><span data-stu-id="460be-106">What is database throughput?</span></span> 

<span data-ttu-id="460be-107">Dataflödet är antalet läsningar och skrivningar som databasen kan utföra under en sekund.</span><span class="sxs-lookup"><span data-stu-id="460be-107">Database throughput is the number of reads and writes that your database can perform in a single second.</span></span>

<span data-ttu-id="460be-108">Om du vill skala ut dataflödet strategiskt måste du uppskatta behovet genom att uppskatta hur många läsningar och skrivningar som kommer att utföras vid olika tidpunkter och för olika dokumentstorlekar.</span><span class="sxs-lookup"><span data-stu-id="460be-108">To scale throughput strategically, you need to estimate your throughput needs by estimating the number of reads and writes you'll have to support at different times and for different document sizes.</span></span> <span data-ttu-id="460be-109">Med en riktig uppskattning håller du användarna nöjda även när efterfrågan är som störst.</span><span class="sxs-lookup"><span data-stu-id="460be-109">If you estimate correctly, you'll keep your users happy when demand spikes.</span></span> <span data-ttu-id="460be-110">Med en felaktig uppskattning kan förfrågningar nedgraderas, åtgärder kan behöva vänta och göras om och svarstiderna kan öka vilket ger missnöjda kunder.</span><span class="sxs-lookup"><span data-stu-id="460be-110">If you estimate incorrectly, your requests can get rate-limited and operations will have to wait and retry, likely causing high latency and unhappy customers.</span></span>

## <a name="what-is-a-request-unit"></a><span data-ttu-id="460be-111">Vad är en enhet för programbegäran?</span><span class="sxs-lookup"><span data-stu-id="460be-111">What is a request unit?</span></span>

<span data-ttu-id="460be-112">Azure Cosmos DB mäter dataflöden i något som kallas **enhet för programbegäran (RU)**.</span><span class="sxs-lookup"><span data-stu-id="460be-112">Azure Cosmos DB measures throughput using something called a **request unit (RU)**.</span></span> <span data-ttu-id="460be-113">Den här enheten mäts per sekund, så måttenheten är **enhet för programbegäran per sekund (RU/s)**.</span><span class="sxs-lookup"><span data-stu-id="460be-113">Request unit usage is measured per second, so the unit of measure is **request units per second (RU/s)**.</span></span> <span data-ttu-id="460be-114">Du måste reservera antalet RU/s som du vill att Azure Cosmos DB ska etablera i förväg, så att den belastning du har uppskattat kan hanteras. Du kan när som helst skala upp eller ned dina RU/s om efterfrågan ändras.</span><span class="sxs-lookup"><span data-stu-id="460be-114">You must reserve the number of RU/s you want Azure Cosmos DB to provision in advance, so it can handle the load you've estimated, and you can scale your RU/s up or down at any time to meet current demand.</span></span>

## <a name="request-unit-basics"></a><span data-ttu-id="460be-115">Översikt över enheter för programbegäran</span><span class="sxs-lookup"><span data-stu-id="460be-115">Request unit basics</span></span>

<span data-ttu-id="460be-116">En enskild enhet för programbegäran, 1 RU, är lika med den ungefärliga kostnaden för att utföra en enda GET-begäran för ett dokument på 1 kB med dokumentets ID.</span><span class="sxs-lookup"><span data-stu-id="460be-116">A single request unit, 1 RU, is equal to the approximate cost of performing a single GET request on a 1-KB document using a document's ID.</span></span> <span data-ttu-id="460be-117">Att utföra en GET med ett dokuments ID är ett effektivt sätt att hämta ett dokument, och därmed är kostnaden liten.</span><span class="sxs-lookup"><span data-stu-id="460be-117">Performing a GET by using a document's ID is an efficient means for retrieving a document, and thus the cost is small.</span></span> <span data-ttu-id="460be-118">Att skapa, ersätta eller ta bort samma objekt kräver ytterligare bearbetning av tjänsten, och därför går det åt flera enheter för programbegäran.</span><span class="sxs-lookup"><span data-stu-id="460be-118">Creating, replacing, or deleting the same item requires additional processing by the service, and therefore requires more request units.</span></span>

<span data-ttu-id="460be-119">Antalet enheter för programbegäran som går åt till en åtgärd varierar med dokumentets storlek, antal egenskaper i dokumentet och vilken åtgärd som utförs. Dessutom beror antalet på en del andra avancerade begrepp som konsekvens och indexeringsprinciper.</span><span class="sxs-lookup"><span data-stu-id="460be-119">The number of request units used for an operation changes depending on the document size, the number of properties in the document, the operation being performed, and some additional complex concepts such as consistency and indexing policy.</span></span>

<span data-ttu-id="460be-120">I följande tabell visas antalet enheter för programbegäran som behövs för objekt i tre olika storlekar (1 kB, 4 kB och 64 kB) på två olika prestandanivåer (500 läsningar/s + 100 skrivningar/s och 500 läsningar/s + 500 skrivningar/s).</span><span class="sxs-lookup"><span data-stu-id="460be-120">The following table shows the number of request units required for items of three different sizes (1 KB, 4 KB, and 64 KB) and at two different performance levels (500 reads/second + 100 writes/second and 500 reads/second + 500 writes/second).</span></span> <span data-ttu-id="460be-121">I det här exemplet är datakonsekvensen inställd på **Session** och indexeringsprincipen på **Ingen**.</span><span class="sxs-lookup"><span data-stu-id="460be-121">In this example, the data consistency is set to **Session**, and the indexing policy is set to **None**.</span></span>

| <span data-ttu-id="460be-122">Objektstorlek</span><span class="sxs-lookup"><span data-stu-id="460be-122">Item size</span></span> | <span data-ttu-id="460be-123">Läsningar per sekund</span><span class="sxs-lookup"><span data-stu-id="460be-123">Reads/second</span></span> | <span data-ttu-id="460be-124">Skrivningar per sekund</span><span class="sxs-lookup"><span data-stu-id="460be-124">Writes/second</span></span> | <span data-ttu-id="460be-125">Enheter för programbegäran</span><span class="sxs-lookup"><span data-stu-id="460be-125">Request units</span></span>
| --- | --- | --- | --- |
| <span data-ttu-id="460be-126">1 kB</span><span class="sxs-lookup"><span data-stu-id="460be-126">1 KB</span></span> | <span data-ttu-id="460be-127">500</span><span class="sxs-lookup"><span data-stu-id="460be-127">500</span></span> | <span data-ttu-id="460be-128">100</span><span class="sxs-lookup"><span data-stu-id="460be-128">100</span></span> | <span data-ttu-id="460be-129">(500 * 1) + (100 * 5) = 1 000 RU/s</span><span class="sxs-lookup"><span data-stu-id="460be-129">(500 * 1) + (100 * 5) = 1,000 RU/s</span></span>
| <span data-ttu-id="460be-130">1 kB</span><span class="sxs-lookup"><span data-stu-id="460be-130">1 KB</span></span> | <span data-ttu-id="460be-131">500</span><span class="sxs-lookup"><span data-stu-id="460be-131">500</span></span> | <span data-ttu-id="460be-132">500</span><span class="sxs-lookup"><span data-stu-id="460be-132">500</span></span> | <span data-ttu-id="460be-133">(500 * 1) + (500 * 5) = 3 000 RU/s</span><span class="sxs-lookup"><span data-stu-id="460be-133">(500 * 1) + (500 * 5) = 3,000 RU/s</span></span>
| <span data-ttu-id="460be-134">4 kB</span><span class="sxs-lookup"><span data-stu-id="460be-134">4 KB</span></span> | <span data-ttu-id="460be-135">500</span><span class="sxs-lookup"><span data-stu-id="460be-135">500</span></span> | <span data-ttu-id="460be-136">100</span><span class="sxs-lookup"><span data-stu-id="460be-136">100</span></span> | <span data-ttu-id="460be-137">(500 * 1,3) + (100 * 7) = 1 350 RU/s</span><span class="sxs-lookup"><span data-stu-id="460be-137">(500 * 1.3) + (100 * 7) = 1,350 RU/s</span></span>
| <span data-ttu-id="460be-138">4 kB</span><span class="sxs-lookup"><span data-stu-id="460be-138">4 KB</span></span> | <span data-ttu-id="460be-139">500</span><span class="sxs-lookup"><span data-stu-id="460be-139">500</span></span> | <span data-ttu-id="460be-140">500</span><span class="sxs-lookup"><span data-stu-id="460be-140">500</span></span> | <span data-ttu-id="460be-141">(500 * 1,3) + (500 * 7) = 4 150 RU/s</span><span class="sxs-lookup"><span data-stu-id="460be-141">(500 * 1.3) + (500 * 7) = 4,150 RU/s</span></span>
| <span data-ttu-id="460be-142">64 kB</span><span class="sxs-lookup"><span data-stu-id="460be-142">64 KB</span></span> | <span data-ttu-id="460be-143">500</span><span class="sxs-lookup"><span data-stu-id="460be-143">500</span></span> | <span data-ttu-id="460be-144">100</span><span class="sxs-lookup"><span data-stu-id="460be-144">100</span></span> | <span data-ttu-id="460be-145">(500 * 10) + (100 * 48) = 9 800 RU/s</span><span class="sxs-lookup"><span data-stu-id="460be-145">(500 * 10) + (100 * 48) = 9,800 RU/s</span></span>
| <span data-ttu-id="460be-146">64 kB</span><span class="sxs-lookup"><span data-stu-id="460be-146">64 KB</span></span> | <span data-ttu-id="460be-147">500</span><span class="sxs-lookup"><span data-stu-id="460be-147">500</span></span> | <span data-ttu-id="460be-148">500</span><span class="sxs-lookup"><span data-stu-id="460be-148">500</span></span> | <span data-ttu-id="460be-149">(500 * 10) + (500 * 48) = 29 000 RU/s</span><span class="sxs-lookup"><span data-stu-id="460be-149">(500 * 10) + (500 * 48) = 29,000 RU/s</span></span>
 
<span data-ttu-id="460be-150">Som du ser måste du reservera fler enheter för programbegäran ju större objektet är och ju fler läsningar och skrivningar som behövs.</span><span class="sxs-lookup"><span data-stu-id="460be-150">As you can see, the larger the item is, and the more reads and writes are required, the more request units you need to reserve.</span></span> <span data-ttu-id="460be-151">När du ska uppskatta dataflödesbehovet i ett program så är [Kapacitetsplaneraren](https://www.documentdb.com/capacityplanner) i Azure Cosmos DB ett onlineverktyg där du kan ladda upp ett JSON-exempeldokument och ställa in hur många åtgärder du behöver utföra per sekund.</span><span class="sxs-lookup"><span data-stu-id="460be-151">If you need to estimate the throughput needs of an application, the Azure Cosmos DB [Capacity Planner](https://www.documentdb.com/capacityplanner) is an online tool that enables you to upload a sample JSON document and set the number of operations you need to complete per second.</span></span> <span data-ttu-id="460be-152">Sedan får du ett uppskattat antal att reservera.</span><span class="sxs-lookup"><span data-stu-id="460be-152">It then provides an estimated total to reserve.</span></span>

## <a name="exceeding-throughput-limits"></a><span data-ttu-id="460be-153">Överskrida dataflödesgränser</span><span class="sxs-lookup"><span data-stu-id="460be-153">Exceeding throughput limits</span></span>

<span data-ttu-id="460be-154">Om du inte reserverar tillräckligt med enheter för programbegäran och försöker läsa eller skriva mer data än det etablerade dataflödet tillåter kommer din begäran att begränsas.</span><span class="sxs-lookup"><span data-stu-id="460be-154">If you don’t reserve enough request units, and you attempt to read or write more data than your provisioned throughput allows, your request will be rate-limited.</span></span> <span data-ttu-id="460be-155">När en begäran begränsas måste den göras om efter ett angivet intervall.</span><span class="sxs-lookup"><span data-stu-id="460be-155">When a request is rate-limited, the request has to be retried again after a specified interval.</span></span> <span data-ttu-id="460be-156">Om du använder .NET SDK görs begäran om automatiskt efter tiden som anges i rubriken retry-after.</span><span class="sxs-lookup"><span data-stu-id="460be-156">If you use the .NET SDK, the request will be retried automatically after waiting the amount of time specified in the retry-after header.</span></span>

## <a name="creating-an-account-built-to-scale"></a><span data-ttu-id="460be-157">Skapa ett konto som är gjort för att skalas om</span><span class="sxs-lookup"><span data-stu-id="460be-157">Creating an account built to scale</span></span>

<span data-ttu-id="460be-158">Du kan när som helst ändra antalet enheter för programbegäran som är etablerade för en databas.</span><span class="sxs-lookup"><span data-stu-id="460be-158">You can change the number of request units provisioned to a database at any time.</span></span> <span data-ttu-id="460be-159">När volymerna är stora kan du skala upp för att tillgodose det högre behovet, och sedan minska det etablerade dataflödet för att minska kostnaderna när behovet är litet.</span><span class="sxs-lookup"><span data-stu-id="460be-159">So, during heavy volume periods, you can scale up to accommodate those high demands, and then reduce provisioned throughput during off peak times to reduce costs.</span></span>

<span data-ttu-id="460be-160">När du skapar ett konto kan du etablera som minst 400 RU/s eller som mest 250 000 RU/s i portalen.</span><span class="sxs-lookup"><span data-stu-id="460be-160">When you create an account, you can provision a minimum of 400 RU/s, or a maximum of 250,000 RU/s in the portal.</span></span> <span data-ttu-id="460be-161">Om du behöver ännu större dataflöde kan du starta ett ärende i Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="460be-161">If you need even more throughput, fill out a ticket in the Azure portal.</span></span> <span data-ttu-id="460be-162">Vi rekommenderar ett inledande dataflöde på 1 000 RU/s för nästan alla konton, eftersom det är det minsta värdet där din databas skalar om automatiskt om du behöver mer än 10 GB lagringsutrymme.</span><span class="sxs-lookup"><span data-stu-id="460be-162">Setting the initial throughput to 1000 RU/s is recommended for almost all accounts, as it is the minimum value in which your database will autoscale should you need more than 10 GB of storage.</span></span> <span data-ttu-id="460be-163">Om du ställer in dataflödet på mindre än 1 000 RU/s kommer databasen inte att skala upp till mer än 10 GB såvida du inte etablerar om databasen och anger en partitionsnyckel.</span><span class="sxs-lookup"><span data-stu-id="460be-163">If you set the initial throughput to any value less than 1000 RU/s, your database will not be able to scale to larger than 10 GB unless you reprovision the database and provide a partition key.</span></span> <span data-ttu-id="460be-164">Partitionsnycklar används för snabba datasökningar i Azure Cosmos DB och gör att du kan skala om databasen automatiskt när det behövs.</span><span class="sxs-lookup"><span data-stu-id="460be-164">Partition keys enable quick lookup of data in Azure Cosmos DB and enable it to autoscale your database when needed.</span></span> <span data-ttu-id="460be-165">Partitionsnycklar diskuteras lite senare i modulen.</span><span class="sxs-lookup"><span data-stu-id="460be-165">Partition keys are discussed a bit later in the module.</span></span>

## <a name="summary"></a><span data-ttu-id="460be-166">Sammanfattning</span><span class="sxs-lookup"><span data-stu-id="460be-166">Summary</span></span>

<span data-ttu-id="460be-167">Nu har du lärt dig hur du kan uppskatta dataflöden för en Azure Cosmos-databas med enheter för programbegäran.</span><span class="sxs-lookup"><span data-stu-id="460be-167">You now understand how to estimate and scope throughput for an Azure Cosmos DB using request units.</span></span> <span data-ttu-id="460be-168">Du kan när som helst ändra antalet enheter för programbegäran, och om du ställer in värdet 1 000 RU/s när du skapar ett konto ser du till att databasen kan skalas om senare.</span><span class="sxs-lookup"><span data-stu-id="460be-168">Request units can be modified at any time, and setting them to 1000 RU/s when you create an account helps ensure your database is ready to scale later.</span></span>